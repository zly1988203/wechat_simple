<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>中交出行</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <link href="../../dist/stylesheets/simpleui.min.css" rel="stylesheet" type="text/css">
    <link href="../../dist/stylesheets/base/vectors.2.css" rel="stylesheet" type="text/css">
    <link href="../../dist/stylesheets/distribution/hunter.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="all-container">
    <div class="poster-container">
        <div class="poster-box" id="poster">
            <img src="../../dist/images/distribution/poster-bg-4.png" id="poster_bg"/>
            <div class="avatar">
                <img src="../../dist/images/coach/ticket-rule-test.gif"/>
            </div>
            <div class="tips">王小瑞请你来坐车</div>
            <div class="company-box">
                <div class="OR-box">
                    <img src="../../dist/images/distribution/trial.jpg"/>
                </div>
                <p>扫描二维码<br/>
                进入中交出行CS</p>
            </div>
        </div>
        <div class="more"></div>
    </div>
    <div class="poster-switch-box">
        <div class="switch clearfloat">
            <div class="item active" data-index="1"></div>
            <div class="item" data-index="2"></div>
            <div class="item" data-index="3"></div>
            <div class="item" data-index="4"></div>
            <div class="item" data-index="5"></div>
        </div>
        <div class="notice">
            <span class="notice-btn">收益须知</span>
        </div>
    </div>

    <!--更多方式弹窗-->
    <div id="more_popup" class="popup-container" style="display: none">
        <div class="popup-box">
            <div class="type-box">
                <div class="type">
                    <h4>方式一</h4>
                    <p>微信右上角分享</p>
                    <p>点击微信右上角三个点“...”通过【发给朋友】【分享到朋友圈】推广</p>
                </div>
                <div class="type">
                    <h4>方式二</h4>
                    <p>复制一下链接推广 <span class="copy-btn">复制链接</span></p>
                    <textarea id="hunterUrl" class="hunter-url" readonly>www：4561SSS4845484textareaextarea.chuxin.com</textarea>
                </div>
            </div>
            <div class="close-btn sui-border-t">关闭</div>
        </div>
    </div>
    <!--收益须知弹窗-->
    <div id="notice_popup" class="popup-container" style="display: none">
        <div class="popup-box">
            <div class="notice-box">
                <div class="title">收益须知</div>
                <div class="img"></div>
                <div class="notice-content">
                    <p>1.您每成功邀请一位好友购买将获得支付金额的一定比例作为奖励</p><br/>
                    <p>2.奖励金额定时结算存入“赚取赏金”，请前往“个人中心”进行查看</p><br/>
                    <p>3.结算时，好友退单将不计入奖励</p><br/>
                    <p>4.您每成功邀请一位好友购买将获得支付金额的一定比例作为奖励</p><br/>
                    <p>5.奖励金额定时结算存入“赚取赏金”，请前往“个人中心”进行查看</p><br/>
                    <p>6.结算时，好友退单将不计入奖励</p><br/>
                    <p>7.您每成功邀请一位好友购买将获得支付金额的一定比例作为奖励</p><br/>
                    <p>8.奖励金额定时结算存入“赚取赏金”，请前往“个人中心”进行查看</p><br/>
                    <p>9.结算时，好友退单将不计入奖励</p>
                </div>
            </div>
            <div class="close-btn sui-border-t">关闭</div>
        </div>
    </div>
</div>

    <div id="canvas-box"></div>
    <div id="img-box"></div>
    <script src="../../dist/javascripts/zepto.min.js"></script>
    <script src="../../dist/javascripts/simpleui.min.js"></script>
    <script src="../../dist/javascripts/vectors.min.js"></script>
    <script src="../../dist/javascripts/html2canvas.min.js"></script>
    <script src="../../dist/javascripts/clipboard.min.js"></script>

    <script>
        $(function () {
            /*更多方式*/
            $('.more').on('click',function () {
                $('#more_popup').show();
            });
            /*复制链接*/
            copyUrl();

            /*海报切换*/
            $('.switch .item').on('click',function () {
                var _index = $(this).data('index');
                var _poster_bg = $('#poster_bg');
                $(this).addClass('active');
                $(this).siblings().removeClass('active');
                if(_index == '1'){
                    $(_poster_bg).attr('src','../../dist/images/distribution/poster-bg-1.png');
                    $('.company-box p').css({'color':'#fff'});
                    $('.poster-box .tips').css({'color':'#fff'});
                }else if(_index == '2'){
                    $(_poster_bg).attr('src','../../dist/images/distribution/poster-bg-2.png');
                    $('.company-box p').css({'color':'#fff'});
                    $('.poster-box .tips').css({'color':'#fff'});
                }else if(_index == '3'){
                    $(_poster_bg).attr('src','../../dist/images/distribution/poster-bg-3.png');
                    $('.company-box p').css({'color':'#5D85B7'});
                    $('.poster-box .tips').css({'color':'#5D85B7'});
                }else if(_index == '4'){
                    $(_poster_bg).attr('src','../../dist/images/distribution/poster-bg-4.png');
                    $('.company-box p').css({'color':'#999'});
                    $('.poster-box .tips').css({'color':'#999'});
                }else if(_index == '5'){
                    $(_poster_bg).attr('src','../../dist/images/distribution/poster-bg-5.png');
                    $('.company-box p').css({'color':'#97AFCB'});
                    $('.poster-box .tips').css({'color':'#97AFCB'});
                }

                //TODO 生成对应的海报


            });

            /*收益须知*/
            $('.notice .notice-btn').on('click',function () {
                $('#notice_popup').show();
            });
            /*关闭更多方式和收益须知*/
            $('.close-btn').on('click',function () {
                $('.popup-container').hide();
            });

            /* *****************div转换为图片开始********************/

            //    html2canvas(document.getElementById('sss')).then(function(canvas) {
            html2canvas(document.getElementById('poster')).then(function(canvas) {
                document.getElementById('canvas-box').appendChild(canvas);
            });
            /*div转为canvas 需要时间*/
            setTimeout(function () {
                //获取网页中的canvas对象
                var mycanvas1 = $('canvas')[0];//document.getElementsByTagName('canvas')[0];
                //将转换后的img标签插入到html中
                var img = convertCanvasToImage(mycanvas1);
                $('#img-box').append(img);//imgDiv表示你要插入的容器id
            },1000);

            /* *****************div转换为图片结束********************/
        });
        //从canvas中提取图片image
        function convertCanvasToImage(canvas) {
            //新Image对象，可以理解为DOM
            var image = new Image();
            // canvas.toDataURL 返回的是一串Base64编码的URL，当然,浏览器自己肯定支持
            // 指定格式PNG
            image.src = canvas.toDataURL("image/png");
            return image;
        }

        /*复制链接*/
        function copyUrl() {
            var clipboard = new ClipboardJS('.copy-btn', {
                target: function() {
                    return document.querySelector('#hunterUrl');
                }
            });
            clipboard.on('success', function(e) {
                $.toastSuccess('复制成功')
                $('#hunterUrl').addClass('copy-s');
                console.log(e);
            });
            clipboard.on('error', function(e) {
                $.toastSuccess('复制失败，请刷新页面重新复制')
                $('#hunterUrl').removeClass('copy-s')
                console.log(e);
            });
        }
    </script>
</body>
</html>