<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>中交出行</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <link href="../../dist/stylesheets/simpleui.min.css" rel="stylesheet" type="text/css">
    <link href="../../dist/stylesheets/base/vectors.2.css" rel="stylesheet" type="text/css">
    <link href="../../dist/stylesheets/base/fy-datepicker.css" rel="stylesheet" type="text/css">
    <link href="../../dist/stylesheets/coach/line-list.css" rel="stylesheet" type="text/css">
</head>

<body>

    <div class="line-list">
        <header>
            <ul class="ola-date">
                <li class="ola-prev ola-disabled" id="preDay"><span>前一天</span></li>
                <li class="ola-current"><label for="date"><span><i>2015-06-16</i><input type="text" id="date" data-date="" readonly /></span></label></li>
                <li class="ola-next" id="nextDay"><span>后一天</span></li>
            </ul>
        </header>

        <div class="main">
            <div class="swapper">
                <div class="item">
                    <div class="left">
                        <h4>11:00</h4>
                    </div>
                    <div class="middle">
                        <div class="station">
                            <div class="station-item">
                                <h4>A8音乐大厦对面</h4>
                            </div>
                            <div class="station-item">
                                <h4>西乡客运站</h4>
                            </div>
                        </div>
                        <div class="type">中型</div>
                    </div>
                    <div class="right">
                        <h2>5.5元</h2>
                        <p>34张</p>
                        <p>约1.5小时</p>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <h4>11:00</h4>
                    </div>
                    <div class="middle">
                        <div class="station">
                            <div class="station-item">
                                <h4>A8音乐大厦对面</h4>
                            </div>
                            <div class="station-item">
                                <h4>西乡客运站</h4>
                            </div>
                        </div>
                        <div class="type">中型</div>
                    </div>
                    <div class="right">
                        <h2>5.5元</h2>
                        <p>34张</p>
                        <p>约1.5小时</p>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <h4>11:00</h4>
                    </div>
                    <div class="middle">
                        <div class="station">
                            <div class="station-item">
                                <h4>A8音乐大厦对面</h4>
                            </div>
                            <div class="station-item">
                                <h4>西乡客运站</h4>
                            </div>
                        </div>
                        <div class="type">中型</div>
                    </div>
                    <div class="right">
                        <h2>5.5元</h2>
                        <p>34张</p>
                        <p>约1.5小时</p>
                    </div>
                </div>

                <!-- disabled：表示禁用，只读 -->
                <div class="item disabled">
                    <div class="left">
                        <h4>11:00</h4>
                    </div>
                    <div class="middle">
                        <div class="station">
                            <div class="station-item">
                                <h4>A8音乐大厦对面</h4>
                            </div>
                            <div class="station-item">
                                <h4>西乡客运站</h4>
                            </div>
                        </div>
                        <div class="type">中型</div>
                    </div>
                    <div class="right">
                        <h2>5.5元</h2>
                        <p>34张</p>
                        <p>约1.5小时</p>
                    </div>
                </div>
                
                <div class="item">
                    <div class="left">
                        <h4>11:00</h4>
                    </div>
                    <div class="middle">
                        <div class="station">
                            <div class="station-item">
                                <h4>A8音乐大厦对面</h4>
                            </div>
                            <div class="station-item">
                                <h4>西乡客运站</h4>
                            </div>
                        </div>
                        <div class="type">中型</div>
                    </div>
                    <div class="right">
                        <h2>5.5元</h2>
                        <p>34张</p>
                        <p>约1.5小时</p>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <h4>11:00</h4>
                    </div>
                    <div class="middle">
                        <div class="station">
                            <div class="station-item">
                                <h4>A8音乐大厦对面</h4>
                            </div>
                            <div class="station-item">
                                <h4>西乡客运站</h4>
                            </div>
                        </div>
                        <div class="type">中型</div>
                    </div>
                    <div class="right">
                        <h2>5.5元</h2>
                        <p>34张</p>
                        <p>约1.5小时</p>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <h4>11:00</h4>
                    </div>
                    <div class="middle">
                        <div class="station">
                            <div class="station-item">
                                <h4>A8音乐大厦对面</h4>
                            </div>
                            <div class="station-item">
                                <h4>西乡客运站</h4>
                            </div>
                        </div>
                        <div class="type">中型</div>
                    </div>
                    <div class="right">
                        <h2>5.5元</h2>
                        <p>34张</p>
                        <p>约1.5小时</p>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <h4>11:00</h4>
                    </div>
                    <div class="middle">
                        <div class="station">
                            <div class="station-item">
                                <h4>A8音乐大厦对面</h4>
                            </div>
                            <div class="station-item">
                                <h4>西乡客运站</h4>
                            </div>
                        </div>
                        <div class="type">中型</div>
                    </div>
                    <div class="right">
                        <h2>5.5元</h2>
                        <p>34张</p>
                        <p>约1.5小时</p>
                    </div>
                </div>
            </div>

            <div class="empty-page">
                <div class="empty-main">
                    <i style="padding-top: 43.07%; background-image: url(../../dist/images/common/icon_defect_line.png);"></i>
                    <p>暂时没有找到合适的线路<br>换个地点再试试吧。</p>
                    <div class="btn primary">回到首页</div>
                </div>
            </div>
        </div>

        <footer>
            <ul class="sub-menu">
                <li id="selectStartStation">出发站点</li>
                <li id="selectEndStation">到达站点</li>
                <li id="selectStartTime">发车时间</li>
            </ul>
        </footer>
    </div>

    <!-- 选择日期 -->
    <div id="select-date" class="sui-popup-container" data-trigger="">
        <div class="sui-popup-mask"></div>
        <div class="sui-popup-modal">
            <div class="date"></div>
        </div>
    </div>

    <!-- 出发站点 -->
    <div id="start-station" class="sui-popup-container foot-handle-popup" data-trigger="">
        <div class="sui-popup-mask"></div>
        <div class="sui-popup-modal">
            <div class="head">
                <button data-handle="reset" class="btn">重置</button>
                <h4>出发地点</h4>
                <button data-handle="submit" class="btn">确定</button>
            </div>
            <div class="scroll-box">
                <ul class="main">
                    <!--默认选项：li添加样式active，input添加属性checked-->
                    <li class="active"><h4>不限</h4><input type="checkbox" class="frm-checkbox" name="startStation" value="不限" checked></li>
                    <li><h4>福田汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="startStation" value="福田汽车客运站"></li>
                    <li><h4>罗湖汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="startStation" value="罗湖汽车客运站"></li>
                    <li><h4>南山汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="startStation" value="南山汽车客运站"></li>
                    <li><h4>盐田汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="startStation" value="盐田汽车客运站"></li>
                    <li><h4>福田汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="startStation" value="福田汽车客运站"></li>
                    <li><h4>罗湖汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="startStation" value="罗湖汽车客运站"></li>
                    <li><h4>南山汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="startStation" value="南山汽车客运站"></li>
                    <li><h4>盐田汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="startStation" value="盐田汽车客运站"></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 到达站点 -->
    <div id="end-station" class="sui-popup-container foot-handle-popup" data-trigger="">
        <div class="sui-popup-mask"></div>
        <div class="sui-popup-modal">
            <div class="head">
                <button data-handle="reset" class="btn">重置</button>
                <h4>到达站点</h4>
                <button data-handle="submit" class="btn">确定</button>
            </div>
            <div class="scroll-box">
                <ul class="main">
                    <!--默认选项：li添加样式active，input添加属性checked-->
                    <li class="active"><h4>不限</h4><input type="checkbox" class="frm-checkbox" name="endStation" value="不限" checked></li>
                    <li><h4>福田汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="endStation" value="福田汽车客运站"></li>
                    <li><h4>罗湖汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="endStation" value="罗湖汽车客运站"></li>
                    <li><h4>南山汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="endStation" value="南山汽车客运站"></li>
                    <li><h4>盐田汽车客运站</h4><input type="checkbox" class="frm-checkbox" name="endStation" value="盐田汽车客运站"></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 发车时间 -->
    <div id="start-time" class="sui-popup-container foot-handle-popup" data-trigger="">
        <div class="sui-popup-mask"></div>
        <div class="sui-popup-modal">
            <div class="head">
                <button data-handle="reset" class="btn">重置</button>
                <h4>发车时间</h4>
                <button data-handle="submit" class="btn">确定</button>
            </div>
            <div class="scroll-box">
                <ul class="main">
                    <!--默认选项：li添加样式active，input添加属性checked-->
                    <li class="active"><h4>不限</h4><input type="checkbox" class="frm-checkbox" name="startTime" value="不限" checked></li>
                    <li><h4>00:00~06:00</h4><input type="checkbox" class="frm-checkbox" name="startTime" value="00:00~06:00"></li>
                    <li><h4>06:00~12:00</h4><input type="checkbox" class="frm-checkbox" name="startTime" value="06:00~12:00"></li>
                    <li><h4>12:00~18:00</h4><input type="checkbox" class="frm-checkbox" name="startTime" value="12:00~18:00"></li>
                    <li><h4>18:00~24:00</h4><input type="checkbox" class="frm-checkbox" name="startTime" value="18:00~24:00"></li>
                </ul>
            </div>
        </div>
    </div>

<script src="../../dist/javascripts/zepto.min.js"></script>
<script src="../../dist/javascripts/simpleui.min.js"></script>
<script src="../../dist/javascripts/vectors.min.js"></script>
<script src="../../dist/javascripts/zepto.scrollTo.min.js"></script>
<script src="../../dist/javascripts/fy-datePicker.min.js"></script>
<script>
    $(function() {
        //前一天
        $('#preDay').on('click', function () {
            //TODO
        });

        //后一天
        $('#nextDay').on('click', function () {
            //TODO
        });

        selectDate();


        //出发站点
        footHandle($('#selectStartStation'), $('#start-station'), function () {
            //TODO
            //选中项
            var station = [];

            $('[name=startStation]:checked').each(function (index, item) {
                station.push($(item).val());
            });

            console.log('出发站点', station);
        });

        //到达站点
        footHandle($('#selectEndStation'), $('#end-station'), function () {
            //TODO
            //选中项
            var station = [];

            $('[name=endStation]:checked').each(function (index, item) {
                station.push($(item).val());
            });

            console.log('到达站点', station);
        });

        //发车时间
        footHandle($('#selectStartTime'), $('#start-time'), function () {
            //TODO
            //选中项
            var startTime = [];

            $('[name=startTime]:checked').each(function (index, item) {
                startTime.push($(item).val());
            });

            console.log('发车时间', startTime);
        });
    });

    /*
    * 选择日期
    * */
    function selectDate() {
        var trigger = $('#date'),
            parent = $('#select-date');
        var initDateStatus = false;

        var init = function () {
            //只初始化一次
            if(!initDateStatus) {
                initDateStatus = true;
                parent.find('.date').datePicker({
                    dateBase: '2017-10-10',
                    weekend: false,
                    multiple: false,
                    gather: createData([10, 11, 12]),
                    selectCallback: function (data) {
                        //TODO
                        parent.closePopup(function () {
                            var d = data.selectData[0].date;
                            var val = d.year + '-' + d.month + '-' + d.day;

                            trigger.val(val).siblings('i').text(val);
                        });
                    }
                });
            }
        };

        //弹出层
        trigger.on('click', function () {
            var self = $(this);

            parent.popup('pull', init);
        });
    }

    //创建随机数据
    function createData(monthDrr) {
        var result = [];

        monthDrr.forEach(function (item, index) {
            var _n = 0,
                _MAX = new Date(2017, item, 0).getDate();

            var arr = [];
            //创建数组
            for(var i = 0; i < _MAX; i++) {
                _n = parseInt(Math.random().toFixed(2) * 10) + i + index;

                if(_n <= _MAX) {
                    arr.push(_n);
                }
            }

            //去重
            for(var n = 0; n < arr.length; n++) {
                for(var m = 0; m < arr.length; m++) {
                    if(arr[n] == arr[m]) {
                        arr.splice(m, 1);
                    }
                }
            }

            //排序
            arr.sort(function () {
                return -1;
            });

            //填充数据
            for(var l = 0; l < arr.length; l++) {
                var _result = {
                    date: '2017-' + item + '-' + arr[l],
                    state: 'select'
                };

                if(parseInt(2 * Math.random())) {
                    _result.comment = '备注';
                }

                /*switch(parseInt(4 * Math.random()) + 1) {
                    case 1:
                        _result.state = 'select';
                        break;
                    case 2:
                        _result.state = 'readonly';
                        break;
                    case 3:
                        _result.state = 'disabled';
                        break;
                }*/
                _result.state = 'select';
                result.push(_result);
            }
        });

        return result;
    }

    /*
    * 底部操作
    * */
    function footHandle(trigger, parent, submitCallback, openCallback) {
        var reset = parent.find('[data-handle=reset]'),
            submit = parent.find('[data-handle=submit]');
        var list = parent.find('.main li'),
            first = list.eq(0);

        var _myIScroll;

        var init = function () {
            var main = parent.find('.scroll-box');
            var MAX = list.height() * 5 / parseFloat($('html').css('font-size')) + 'rem';
            main.css('max-height', MAX);

            // 绑定滚动条
            var bindScroll = function() {
                if(_myIScroll) {
                    _myIScroll.destroy();
                }
                setTimeout(function() {
                    _myIScroll = new IScroll('#' + parent.attr('id') + ' .scroll-box', {
                        click: iScrollClick(),
                        scrollX: false,
                        scrollY: true,
                        mouseWheel: true
                    });
                }, 300);
            };
            bindScroll();
        };

        //兼容安卓
        function iScrollClick(){
            if (/iPhone|iPad|iPod|Macintosh/i.test(navigator.userAgent)) return false;
            if (/Chrome/i.test(navigator.userAgent)) return (/Android/i.test(navigator.userAgent));
            if (/Silk/i.test(navigator.userAgent)) return false;
            if (/Android/i.test(navigator.userAgent)) {
                var s=navigator.userAgent.substr(navigator.userAgent.indexOf('Android')+8,3);
                return parseFloat(s[0]+s[3]) < 44 ? false : true
            }
        }

        //弹出层
        trigger.on('click', function () {
            parent.popup('plate', function () {
                //显示前触发函数
                if(openCallback instanceof Function) {
                    openCallback();
                }
            });

            if(!parent.data('init')) {
                parent.data('init', true);
                init();
            }
        });

        //选择站点
        list.on('click', function () {
            var self = $(this),
                ipt = self.find('input');

            if(!self.hasClass('active')) {
                self.addClass('active');
                ipt.prop('checked', true);

                if(ipt.val() == '不限') {
                    //选择不限：其他取消选中
                    first.addClass('active').find('input').prop('checked', true);
                    first.nextAll().removeClass('active').find('input').prop('checked', false);
                } else if(first.find('input:checked').length == 1) {
                    //选择其他项：如果不限已被选中，则取消不限
                    first.removeClass('active').find('input').prop('checked', false);
                }
            } else {
                self.removeClass('active');
                ipt.prop('checked', false);

                if(first.nextAll('.active').length == 0) {
                    //除不限以外，其他都取消选择
                    first.addClass('active').find('input').prop('checked', true);
                }
            }
        });

        //重置
        reset.on('click', function () {
            first.addClass('active').find('input').prop('checked', true);
            first.siblings().removeClass('active').find('input').prop('checked', false);
        });

        //确定
        submit.on('click', function () {
            //关闭弹出层
            parent.closePopup(function () {
                //关闭后触发函数
                if(submitCallback instanceof Function) {
                    submitCallback();
                }
            });
        });
    }
</script>
</body>
</html>