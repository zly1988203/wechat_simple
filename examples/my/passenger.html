<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>中交出行</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <link href="../../dist/stylesheets/simpleui.min.css" rel="stylesheet" type="text/css">
    <link href="../../dist/stylesheets/base/vectors.2.css" rel="stylesheet" type="text/css">
    <link href="../../dist/stylesheets/bus/passenger.css" rel="stylesheet" type="text/css">
</head>

<body>
    <div class="passenger-list-wrapper">
        <ul class="sui-list passenger-handle sui-list-cover sui-border-b">
            <li class="sui-cell-centerlink add-btn addPassengerButton">添加乘车人</li>
            <li class="sui-cell-centerlink del-btn delPassengerButton">删除乘车人</li>
        </ul>
        <ul class="passenger-list sui-list sui-list-cover">
            <!--
                data-name：  姓名
                data-phone： 手机号码
                data-code：  身份证号码
            -->
            <li class="sui-border-b" data-name="牛嘎嘎" data-phone="151180303494" data-code="440681*********5913">
                <div class="info">
                    <h4>牛嘎嘎</h4>
                    <p><em>手机号</em>151180303494</p>
                    <p><em>身份证</em>440681*********5913</p>
                </div>
                <div class="handle">
                    <i class="icon-edit editPassengerButton"></i>
                </div>
            </li>
            <li data-name="李梅梅" data-phone="151180303494" data-code="440681*********5913">
                <div class="info">
                    <h4>李梅梅</h4>
                    <p><em>手机号</em>151180303494</p>
                    <p><em>身份证</em>440681*********5913</p>
                </div>
                <div class="handle">
                    <i class="icon-edit editPassengerButton"></i>
                </div>
            </li>
        </ul>
    </div>

    <div class="not-data" style="background-image: url(../../dist/images/common/icon_no_rider.png);">您当前还未添加乘车人</div>

    <!--添加乘车人-->
    <div id="addPassenger" class="sui-popup-container">
        <div class="sui-popup-mask"></div>
        <div class="sui-popup-modal">

            <div class="add-passenger-wrapper">
                <ul class="form sui-list sui-list-cover">
                    <li class="sui-border-b">
                        <label>姓名</label>
                        <input type="text" id="addPassengerName" placeholder="请输入姓名" />
                    </li>
                    <li class="sui-border-b">
                        <label>手机号</label>
                        <input type="text" id="addPassengerPhone" placeholder="请输入手机号" />
                    </li>
                    <li class="sui-border-b">
                        <label>身份证</label>
                        <input type="text" id="addPassengerCode" placeholder="请输入身份证" />
                    </li>
                </ul>
            </div>

            <div class="btn-group">
                <button class="btn default" id="cancelAddButton">取消</button>
                <button class="btn primary" id="submitAddButton">确定</button>
            </div>

        </div>
    </div>

    <!--编辑乘车人-->
    <div id="editPassenger" class="sui-popup-container">
        <div class="sui-popup-mask"></div>
        <div class="sui-popup-modal">

            <div class="edit-passenger-wrapper">
                <ul class="form sui-list sui-list-cover">
                    <li class="sui-border-b">
                        <label>姓名</label>
                        <input type="text" id="editPassengerName" placeholder="请输入姓名" />
                    </li>
                    <li class="sui-border-b">
                        <label>手机号</label>
                        <input type="text" id="editPassengerPhone" placeholder="请输入手机号" />
                    </li>
                    <li class="sui-border-b">
                        <label>身份证</label>
                        <input type="text" id="editPassengerCode" placeholder="请输入身份证" />
                    </li>
                </ul>
            </div>

            <div class="btn-group">
                <button class="btn primary" id="submitEditButton">确定</button>
            </div>

        </div>
    </div>

    <!--删除乘车人-->
    <div id="delPassenger" class="sui-popup-container">
        <div class="sui-popup-mask"></div>
        <div class="sui-popup-modal">

            <div class="passenger-list-wrapper">
                <ul class="passenger-list sui-list sui-list-cover">
                    <!--
                        data-select：是否选中
                        data-name：  姓名
                        data-phone： 手机号码
                        data-code：  身份证号码
                    -->
                    <li class="sui-border-b" data-select="false" data-name="牛嘎嘎" data-phone="151180303494" data-code="440681*********5913">
                        <div class="name">
                            <input type="checkbox" class="frm-checkbox" />
                        </div>
                        <div class="info">
                            <h4>牛嘎嘎</h4>
                            <p><em>手机号</em>151180303494</p>
                            <p><em>身份证</em>440681*********5913</p>
                        </div>
                    </li>
                    <li data-select="false" data-name="李梅梅" data-phone="151180303494" data-code="440681*********5913">
                        <div class="name">
                            <input type="checkbox" class="frm-checkbox" />
                        </div>
                        <div class="info">
                            <h4>李梅梅</h4>
                            <p><em>手机号</em>151180303494</p>
                            <p><em>身份证</em>440681*********5913</p>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="btn-group">
                <button class="btn primary" id="submitDelButton">删除</button>
            </div>

        </div>
    </div>
    
    <script src="../../dist/javascripts/zepto.min.js"></script>
    <script src="../../dist/javascripts/simpleui.min.js"></script>
    <script src="../../dist/javascripts/common.min.js"></script>
    <script>
        $(function() {
            // 绑定滚动条
            var _myIScroll;
            var bindScroll = function() {
                if(_myIScroll) {
                    _myIScroll.destroy();
                }
                setTimeout(function() {
                    $('.listWrapper').css('height', ($(window).height() - 74) + 'px');
                    _myIScroll = new IScroll('.listWrapper');
                }, 300);
            }

            /*
             * 添加乘客
             * */
            // 打开添加界面
            $('.addPassengerButton').on('click', function() {
                $('#addPassenger').popup('push', function() {
                    $('#name').val('');
                    $('#phone').val('');
                    $('#code').val('');
                })
            });

            //取消添加
            $('#cancelAddButton').on('click', function () {
                $('#addPassenger').closePopup();
            });

            //提交添加
            $('#submitAddButton').on('click', function() {

                //TODO: 提交添加
                var name = $('#addPassengerName').val();
                var phone = $('#addPassengerPhone').val();
                var code = $('#addPassengerCode').val();

                //创建标签
                var $strLi = $('<li class="sui-border-b" data-name="' + name + '" data-phone="' + phone + '" data-code="' + code + '"></li>'),
                    $strInfo = $('<div class="info"><h4>' + name + '</h4><p><em>手机号</em>' + phone + '</p><p><em>身份证</em>' + code + '</p></div>'),
                    $strHandle = $('<div class="handle"><i class="icon-edit editPassengerButton"></i></div>');

                //合并标签
                $strLi.append($strInfo).append($strHandle);

                //添加到父元素里
                $('.passenger-list').append($strLi);

                //绑定 - 编辑乘客
                $strHandle.find('.editPassengerButton').on('click', function () {
                    editHandle($(this));
                });

                if(_myIScroll) {
                    _myIScroll.refresh();   // 刷新滚动条
                }

                $('#addPassenger').closePopup();
            });

            /*
             * 编辑乘客
             * */
            //编辑操作
            function editHandle(el) {
                var $parent = el.parents('li');
                var _name  = $parent.data('name'),
                    _phone = $parent.data('phone'),
                    _code  = $parent.data('code');

                $('#editPassenger').popup('push', function() {
                    $('#editPassengerName').val(_name);
                    $('#editPassengerPhone').val(_phone);
                    $('#editPassengerCode').val(_code);

                    //设置触发的元素
                    $('#editPassenger').data('trigger', $parent.index());
                });
            }

            // 打开编辑界面
            $('.editPassengerButton').on('click', function() {
                editHandle($(this));
            });

            //关闭编辑
            $('#submitEditButton').on('click', function () {
                $('#editPassenger').closePopup(function () {
                    var targetZindex = $('#editPassenger').data('trigger'),
                        _target = $('.passenger-list li').eq(targetZindex);
                    var _editName = $('#editPassengerName').val(),
                        _phoneName = $('#editPassengerPhone').val(),
                        _codeName = $('#editPassengerCode').val();

                    //更新 - 存储数据
                    _target.data('name', _editName)
                        .data('phone', _phoneName)
                        .data('code', _codeName);

                    //更新 - 展示数据
                    _target.find('.info h4').text(_editName);
                    _target.find('.info p:first').html('</h4><p><em>手机号</em>' + _phoneName);
                    _target.find('.info p:last').html('</h4><p><em>身份证</em>' + _codeName);
                });
            });

            // 打开删除界面
            $('.delPassengerButton').on('click', function() {
                $('#delPassenger').popup('push');
            });

            //提交删除
            $('#submitDelButton').on('click', function() {

                //TODO: 提交删除


                if(_myIScroll) {
                    _myIScroll.refresh();   // 刷新滚动条
                }

                $('#delPassenger').closePopup();
            });
        });
    </script>
</body>
</html>