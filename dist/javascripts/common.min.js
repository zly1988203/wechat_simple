function showEmp(){var e=SERVER_URL_PREFIX+"/Account/userType",t={};t=genReqData(e,t);var r=$.cookie("token");t.token=r,$.post(e,t,function(e){if(e&&0==e.code){if("1"==e.data.isEmp){var t="https://osp."+adDomain+"/wechat/employee_credit/index?providerId="+providerId+"&token="+$.cookie("token");$("#toEmp").data("url",t),$("#toEmp").show()}if("1"==e.data.checkGift){t="https://osp."+adDomain+"/wechat/activity/cdkeyVerify?providerId="+providerId+"&token="+$.cookie("token");$("#toCheckGift").data("url",t),$("#toCheckGift").show()}}})}function queryUserCouponsNum(){var e=SERVER_URL_PREFIX+"/Coupon/queryUserCouponsNum",t={};t=genReqData(e,t);var r=$.cookie("token");t.token=r,$.ajaxService({url:e,data:t,success:function(e){if(0==e.code){var t=e.data;t.count>0?($("#sideMenu .coupon-number").html(t.count+"张"),$("#sideMenu .coupon-number").show()):$("#sideMenu .coupon-number").hide()}else $("#sideMenu .coupon-number").hide()}})}function isWechatBrowser(){return!!(-1!=navigator.userAgent.toLowerCase().indexOf("micromessenger"))}function toCommonLogin(){var e=window.location.href;-1===e.indexOf("/selectionLogin")&&-1===e.indexOf("/regOrLogin")&&(isWechatBrowser()?location.href="/wechat/autoLogin":1==loginType?location.href="/selectionLogin":location.href="/regOrLogin")}function getLocalTime(e){var t=new Date(e),r=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+r+":"+o}function getLocalTime2(e){var t=new Date(e),r=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return t.getFullYear()+","+(t.getMonth()+1)+","+t.getDate()+", "+r+":"+o}function getLocalTime3(e){var t=new Date(e);t.getHours(),t.getHours(),t.getMinutes(),t.getMinutes();return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "}function getLocalTime4(e){var t=new Date(e),r=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return t.getMonth()+1+"月"+t.getDate()+"日 "+r+":"+o}function getTicketListOrderDate(e){var t=new Date(e);return(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+" "+(t.getMonth()+1)+"月"+t.getDate()+"日 "}function getLocalTime5(e){var t=new Date(e),r=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,o=t.getDate()<10?"0"+t.getDate():t.getDate();return t.getFullYear()+"-"+r+"-"+o}function isEmpty(e){return null==e||""===e}function getSignStr(e,t){if(null===e||null===t)return"";e=e.substring(e.indexOf("//",0)+2,e.length);var r="?",o=new Array;for(var n in t)o.push(n);for(var a in null==t.token&&(t.token=""),o.sort(),o){"nickName"!==(n=o[a])&&"sign"!==n&&(r+=o[a]+"="+t[o[a]]+"&")}return r+=APP_KEY,e.indexOf("/hail")>=0&&(e=e.replace("/hail","")),$.md5(e+r)}function genReqData(e,t){var r={clientType:CLIENT_TYPE,appId:APP_ID,token:$.cookie("token"),appVersion:APP_VERSION,timestamp:(new Date).getTime(),deviceId:DEVICE_ID,wechatLogin:WECHATLOGIN},o=getSignStr(e,r=$.extend(r,t));return r.sign=o,r}function hasUnFinishOrderOrTrip(e,t,r){$.showLoading("查询行程状态 ");var o=SERVER_URL_PREFIX+"/Order/queryUnFinishOrderOrTrip",n={};n=genReqData(o,n),$.ajax({type:"POST",url:o,data:n,dataType:"json",success:function(o){if($.hideLoading(),60001!=o.code)if(0==o.data.orderStatus)e&&drivePlugin.search(t,r,driveRouteResult);else{var n=o.data.goToResult;n?n.isRedirectAlert?$.dialog({text:n.title,title:"提示",buttons:[{text:n.cancel,onClick:function(){$.hideLoading()}},{text:n.confirm,onClick:function(){window.location.href=CURRENT_SERVER+n.url}}]}):$.alert(n.title):$.toastError("行程出错啦")}else $.alert(o.message)}})}function listenTrip(e,t){var r=SERVER_URL_PREFIX+"/Trip/listenTrip",o={tripNo:e,currentUrl:t};o=genReqData(r,o),$.ajax({type:"POST",url:r,data:o,dataType:"json",success:function(e){if(0==e.code){var r=e.data.goToResult;if("toOrderWait"==t){var o=e.data.status;9==o?window.location=CURRENT_SERVER+"/index":4!=o&&3!=o||$("#orderFlag").val(1)}$("#callOutTime").val(e.data.callOutTime);var n=(e.data.reatTime-e.data.createTime)/1e3;$("#min").val(parseInt(n/60)),$("#secs").val(parseInt(n-60*parseInt(n/60))),r&&alertFlag&&(r.isRedirectAlert?window.location.href=CURRENT_SERVER+r.url:(window.clearInterval(tripInterval),$.dialog({text:r.title,title:"提示",buttons:[{text:"确定",onClick:function(){r.url&&(window.location.href=CURRENT_SERVER+r.url)}}]})))}}})}function backtoUrl(e){pushHistory();var t=!1;setTimeout(function(){t=!0},500),window.addEventListener("popstate",function(r){t&&(location.href=e),pushHistory()},!1)}function pushHistory(){window.history.pushState({title:"title",url:"#"},"title","#")}function toHref(e,t){if(7!=t.orderStatus)switch(e){case 1:case 2:case 3:window.location.href=CURRENT_SERVER+"/order/toOrderWait?tripNo="+t.tripNo+"&tipsMessage=&createTime="+t.createTime;break;case 4:window.location.href=CURRENT_SERVER+"/order/toWaitDriver?orderNo="+t.orderNo;break;case 5:window.location.href=CURRENT_SERVER+"/order/toDriverArrived?orderNo="+t.orderNo;break;case 6:case 7:window.location.href=CURRENT_SERVER+"/order/toStartTrip?orderNo="+t.orderNo;break;case 8:window.location.href=CURRENT_SERVER+"/order/toPay/"+t.orderNo}else window.location.href=CURRENT_SERVER+"/index"}function listenOrder(e,t){var r=SERVER_URL_PREFIX+"/Order/listenOrder",o={orderNo:e,currentUrl:t};o=genReqData(r,o),$.ajax({type:"POST",url:r,data:o,dataType:"json",success:function(e){if(0==e.code){var t=e.data.goToResult;t&&(t.isRedirectAlert?window.location.href=CURRENT_SERVER+t.url:(window.clearInterval(tripInterval),$.dialog({text:t.title,title:"提示",buttons:[{text:"确定",onClick:function(){t.url&&(window.location.href=CURRENT_SERVER+t.url)}}]})))}}})}function callDriver(e){$.confirm("确定拨打司机电话吗?。","提示",["取消","确定"],function(){var t=SERVER_URL_PREFIX+"/Call/callDriver",r={orderNo:e};r=genReqData(t,r),$.ajax({type:"POST",url:t,data:r,dataType:"json",success:function(e){e&&0==e.code&&(window.location.href="tel:"+e.data.callee)}})})}function contact(e,t,r){var o=SERVER_URL_PREFIX+"/Contact/rescue";null!=r&&""!=r&&(o=r+"/Contact/rescue");var n=null!=t?t:"online",a={orderNo:e};a=genReqData(o,a),$.ajax({type:"POST",url:o,data:a,dataType:"json",success:function(e){0==e.code?$.toastSuccess("紧急求助短信<br>发送成功"):$.confirm(e.message,"温馨提示",["取消","去设置"],function(){window.location.href="/passenger/contacts.html?type="+n+"&orderNo="+a.orderNo},function(){})}})}function callComm(e){$.confirm("确定拨打客服电话吗?。","提示",["取消","确定"],function(){var t=SERVER_URL_PREFIX+"/Config/commonConfig",r={orderNo:e};r=genReqData(t,r),$.ajax({type:"POST",url:t,data:r,dataType:"json",success:function(e){e&&0==e.code&&(window.location.href="tel:"+e.data.customerTel)}})})}function cancelBtn(){var e=SERVER_URL_PREFIX+"/Order/cancelOrder",t={orderNo:"${orderNo}"};t=genReqData(e,t),$.confirm("司机正火速赶来，再等会司机吧！为避免影响你的信誉，若为司机的责任，请让司机取消。","无责取消",["暂不取消","确定取消"],function(){$.ajax({type:"POST",url:e,data:t,dataType:"json",success:function(e){0==e.code&&(window.clearInterval(tripInterval),1==e.paySwitch?$.toastSuccess("需要支付违约金："+amount):$.toastSuccess("不需要支付违约金"),window.location=CURRENT_SERVER+"/order/toOrderCancel?orderNo=${orderNo}")}})})}function searchAddressByGps(e,t){var r=SERVER_URL_PREFIX+"/searchAddressByGps",o={gps:e};o=genReqData(r,o),$.ajax({type:"GET",url:r,data:o,dataType:"json",success:function(e){0==e.code&&t(e.data)}})}function add(e,t){var r,o,n;try{r=e.toString().split(".")[1].length}catch(e){r=0}try{o=t.toString().split(".")[1].length}catch(e){o=0}return(mul(e,n=Math.pow(10,Math.max(r,o)))+mul(t,n))/n}function sub(e,t){var r,o,n;try{r=e.toString().split(".")[1].length}catch(e){r=0}try{o=t.toString().split(".")[1].length}catch(e){o=0}return(mul(e,n=Math.pow(10,Math.max(r,o)))-mul(t,n))/n}function mul(e,t){var r=0,o=e.toString(),n=t.toString();try{r+=o.split(".")[1].length}catch(e){}try{r+=n.split(".")[1].length}catch(e){}return Number(o.replace(".",""))*Number(n.replace(".",""))/Math.pow(10,r)}function div(e,t){var r=0,o=0;try{r=e.toString().split(".")[1].length}catch(e){}try{o=t.toString().split(".")[1].length}catch(e){}return mul(Number(e.toString().replace(".",""))/Number(t.toString().replace(".","")),Math.pow(10,o-r))}function postPage(e,t){var r=document.createElement("form");for(var o in r.action=e,r.target="_self",r.method="post",r.style.display="none",t){var n=document.createElement("textarea");n.name=t[o].name,n.value=t[o].value,r.appendChild(n)}document.body.appendChild(r),r.submit()}function saveTwoDigit(e){return null==e||null==e?0:Math.round(100*parseFloat(e))/100}function callDriver(e){var t=SERVER_URL_PREFIX+"/Call/callDriver",r={orderNo:e};r=genReqData(t,r),$.ajax({type:"POST",url:t,data:r,dataType:"json",success:function(t){t&&0==t.code?"1"==t.data.isOpenSafeCall&&null==$.cookie("firstCall")?$.confirm("拨打司机手机号时，系统将会采用隐号功能，隐藏你们的真实手机号，请放心拨打。","提示",["取消","确定"],function(){$.cookie("firstCall","firstCall"),window.location.href="tel:"+t.data.callee}):window.location.href="tel:"+t.data.callee:50001==t.code&&callCustomerService(e)}})}function callDriverByServer(e,t){var r=e+"/Call/callDriver",o={orderNo:t};o=genReqData(r,o),$.ajax({type:"POST",url:r,data:o,dataType:"json",success:function(e){e&&0==e.code?"1"==e.data.isOpenSafeCall&&null==$.cookie("firstCall")?$.confirm("拨打司机手机号时，系统将会采用隐号功能，隐藏你们的真实手机号，请放心拨打。","提示",["取消","确定"],function(){$.cookie("firstCall","firstCall"),window.location.href="tel:"+e.data.callee}):window.location.href="tel:"+e.data.callee:50001==e.code&&callCustomerService(t)}})}function callCustomerService(e){$.confirm("订单已结束多时，如需联系司机 ，可联系客服帮忙","提示",["取消","联系客服"],function(){var t=SERVER_URL_PREFIX+"/Config/commonConfig",r={orderNo:e};r=genReqData(t,r),$.ajax({type:"POST",url:t,data:r,dataType:"json",success:function(e){e&&0==e.code&&(window.location.href="tel:"+e.data.customerTel)}})})}function formatTime(e){if(isNumber(e)){var t=new Date(parseInt(e));return e=t.getFullYear()+"-"+formatNum(t.getMonth()+1)+"-"+formatNum(t.getDate())+" "+formatNum(t.getHours())+":"+formatNum(t.getMinutes())+":"+formatNum(t.getSeconds())}return""}function formatNum(e){return 1==(e+"").length&&e<10&&(e="0"+e),e}function isNumber(e){return/^[1-9]\d*|0$/.test(e)}function formatMoney(e,r){r=r>0&&r<=20?r:2;var o=(e=parseFloat((e+"").replace(/[^\d\.-]/g,"")).toFixed(r)+"").split(".")[0].split("").reverse(),n=e.split(".")[1];for(t="",i=0;i<o.length;i++)t+=o[i]+((i+1)%3==0&&i+1!=o.length?",":"");return t.split("").reverse().join("")+"."+n}function Base64(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encode=function(e){var t,r,o,n,a,i,c,l="",s=0;for(e=_utf8_encode(e);s<e.length;)n=(t=e.charCodeAt(s++))>>2,a=(3&t)<<4|(r=e.charCodeAt(s++))>>4,i=(15&r)<<2|(o=e.charCodeAt(s++))>>6,c=63&o,isNaN(r)?i=c=64:isNaN(o)&&(c=64),l=l+_keyStr.charAt(n)+_keyStr.charAt(a)+_keyStr.charAt(i)+_keyStr.charAt(c);return l},this.decode=function(e){var t,r,o,n,a,i,c="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=_keyStr.indexOf(e.charAt(l++))<<2|(n=_keyStr.indexOf(e.charAt(l++)))>>4,r=(15&n)<<4|(a=_keyStr.indexOf(e.charAt(l++)))>>2,o=(3&a)<<6|(i=_keyStr.indexOf(e.charAt(l++))),c+=String.fromCharCode(t),64!=a&&(c+=String.fromCharCode(r)),64!=i&&(c+=String.fromCharCode(o));return c=_utf8_decode(c)},_utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var o=e.charCodeAt(r);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode=function(e){for(var t="",r=0,o=c1=c2=0;r<e.length;)(o=e.charCodeAt(r))<128?(t+=String.fromCharCode(o),r++):o>191&&o<224?(c2=e.charCodeAt(r+1),t+=String.fromCharCode((31&o)<<6|63&c2),r+=2):(c2=e.charCodeAt(r+1),c3=e.charCodeAt(r+2),t+=String.fromCharCode((15&o)<<12|(63&c2)<<6|63&c3),r+=3);return t}}$(function(){var e,t;$("[data-href]").on("click",function(){location.href=$(this).data("href")}),$.extend($.ajaxSettings,{error:function(e,t,r){switch(e.status){case 401:var o=window.location.href,n=o.indexOf(CURRENT_SERVER_SUFFIX);o=o.substring(n+CURRENT_SERVER_SUFFIX.length,o.length);var a=new Date;a.setTime(a.getTime()+6e5),$.cookie("fromUrl",o,{expires:a,path:"/"}),toCommonLogin();break;case 500:break;case 408:$.toastError("网络异常");break;default:$.hideLoading()}},success:function(e){}}),e=SERVER_URL_PREFIX+"/Account/queryAccount",t=genReqData(e,t={}),$.post(e,t,function(e){if(e&&0==e.code){var t=e.data.mobile,r=e.data.nickName;isEmpty(e.data.avatar)||$("#avatar").css("background-image","url("+e.data.avatarUrl+")"),isEmpty(r)?$("#sideMenu .mobile").html(t):$("#sideMenu .mobile").html(r),null!=e.data.distribUserType&&1==e.data.distribUserType&&($("title").html(e.data.providerName),$("#myBounty").show(),$("#getBounty").show());var o=e.data;localStorage.setItem("userInfo",JSON.stringify(o))}else console.log(e),e&&(o=e.data,localStorage.setItem("userInfo",JSON.stringify(o))),1==loginType?$("#sideMenu .mobile").html("<a href='/selectionLogin'>登录</a>"):$("#sideMenu .mobile").html("<a href='/regOrLogin'>登录</a>")},"json")}),$("#menuArmrest").on("click",function(){var e=JSON.parse(localStorage.getItem("userInfo"));null!=e&&null!=e.identifyId&&(showEmp(),queryUserCouponsNum())}),Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e},Number.prototype.toFixed=function(e){if(e||(e=0),-1==(t=this+"").indexOf(".")&&(t+="."),t+=new Array(e+1).join("0"),new RegExp("^(-|\\+)?(\\d+(\\.\\d{0,"+(e+1)+"})?)\\d*$").test(t)){var t="0"+RegExp.$2,r=RegExp.$1,o=RegExp.$3.length,n=!0;if(o==e+2){if(o=t.match(/\d/g),parseInt(o[o.length-1])>4)for(var a=o.length-2;a>=0&&(o[a]=parseInt(o[a])+1,10==o[a]);a--)o[a]=0,n=1!=a;t=o.join("").replace(new RegExp("(\\d+)(\\d{"+e+"})\\d$"),"$1.$2")}return n&&(t=t.substr(1)),(r+t).replace(/\.$/,"")}return this+""};