$(function(){var e=$("#isShow").val();"0"===e&&$("#resbtn").css("background","#ccc");var a=new Date((new Date).getTime()),t=a.getFullYear()+"-"+zeroize(a.getMonth()+1)+"-"+zeroize(a.getDate()),s=a.getFullYear()+"-"+zeroize(a.getMonth()+1)+"-"+zeroize(a.getDate()+1);$("#present_startTime").data("date",t),$("#present_endTime").data("date",s),$("#present_endTime").val("明天 09点 00分"),$("#tabOne").on("click",function(){$("#tabWay").val("1"),$("#tabTwo").removeClass("active"),$("#dvEndTime").addClass("undisplay"),$(this).addClass("active")}),$("#tabTwo").on("click",function(){$("#tabWay").val("2"),$("#tabOne").removeClass("active"),$("#dvEndTime").removeClass("undisplay"),$(this).addClass("active")}),dataUtils.exChangeVal($(".exchange"),$("#startAddr"),$("#endAddr")),adrsUtils.selectAddress({el_trigger:$(".search-station li"),el_popup:$("#search-address")}),adrsUtils.openCity({el_trigger:$("#setCityButton"),el_popup:$("#select-Citys")}),$("#resbtn").on("click",function(){if("0"===e)return $(".cover").removeClass("undisplay"),$("#msgBox").removeClass("undisplay"),void $("#msgBox .content").html("此功能暂未开发。");if("1"===$("#tabWay").val()?($("#resWay").html("单程"),$("#returnItem").addClass("undisplay")):($("#returnItem").removeClass("undisplay"),$("#resWay").html("往返")),""===$("#startAddr").val())return $(".cover").removeClass("undisplay"),$("#msgBox").removeClass("undisplay"),void $("#msgBox .content").html("请选择您的上车地点。");if(""===$("#endAddr").val())return $(".cover").removeClass("undisplay"),$("#msgBox").removeClass("undisplay"),void $("#msgBox .content").html("请选择您要到达的地点。");if(""===$("#present_startTime").val())return $(".cover").removeClass("undisplay"),$("#msgBox").removeClass("undisplay"),void $("#msgBox .content").html("请选择您何时出发。");if("2"===$("#tabWay").val()){var a=function(){var e=new Date((new Date).getTime()),a=e.getFullYear()+"-"+zeroize(e.getMonth()+1)+"-"+zeroize(e.getDate()),t=$("#present_startTime").data("date")+" "+$("#present_startTime").data("time")+":"+$("#present_startTime").data("minute");"now"===$("#present_startTime").data("time")&&(t=a+" "+zeroize(e.getHours())+":"+zeroize(e.getMinutes()));var s=$("#present_endTime").data("date")+" "+$("#present_endTime").data("time")+":"+$("#present_endTime").data("minute");2==$("#tabWay").val()&&"now"===$("#present_endTime").data("time")&&(s=a+" "+zeroize(e.getHours())+":"+zeroize(e.getMinutes()));return{departTime:t,returnTime:s}}();if(!function(e,a){var t=new Date(e.replace(/\-/g,"/")),s=new Date(a.replace(/\-/g,"/"));if(""!=e&&""!=a&&t>=s)return!1;return!0}(a.departTime,a.returnTime))return $(".cover").removeClass("undisplay"),$("#msgBox").removeClass("undisplay"),void $("#msgBox .content").html("返程时间不能小于出发时间。")}if(""===$("#present_peopleNumber").val())return $(".cover").removeClass("undisplay"),$("#msgBox").removeClass("undisplay"),void $("#msgBox .content").html("请填写出行人数。");if(!/^[0-9]*[1-9][0-9]*$/.test($("#present_peopleNumber").val()))return $(".cover").removeClass("undisplay"),$("#msgBox").removeClass("undisplay"),void $("#msgBox .content").html("出行人数必须为大于0的正整数。");var t,s=$("#present_phone").val();return""===s?($(".cover").removeClass("undisplay"),$("#msgBox").removeClass("undisplay"),void $("#msgBox .content").html("请填写你的手机号码。")):/^1[3|4|5|7|8]\d{9}$/.test(t=s)||/^0\d{2,3}-?\d{7,8}$/.test(t)?($("#startPlace").html($("#startAddr").val()),$("#endPalce").html($("#endAddr").val()),$("#startTime").html($("#present_startTime").val()),$("#returnTime").html($("#present_endTime").val()),$("#personNumb").html($("#present_peopleNumber").val()+"人"),$("#personPhone").html($("#present_phone").val()),$("#remark").html($("#present_remark").val()),$(".cover").removeClass("undisplay"),void $("#reservationInfo").removeClass("undisplay")):($(".cover").removeClass("undisplay"),$("#msgBox").removeClass("undisplay"),void $("#msgBox .content").html("你填写的电话号码不正确。"))});var r=!1;$("#submitInfo").on("click",function(){$("#reservationInfo").addClass("undisplay"),navigator.onLine||$("#msgBox .content").html("您可能断网了，请检查网络"),r=!0,$("#msgBox").removeClass("undisplay")}),$("#reservationInfo .icon-close").on("click",function(){$(".cover").addClass("undisplay"),$("#reservationInfo").addClass("undisplay")}),$("#msgBox .btn-konw").on("click",function(){$(".cover").addClass("undisplay"),$("#msgBox").addClass("undisplay"),r&&location.reload()}),$("#present_remark").on("input",function(){var e=$(this).val().length;e<=100&&$(this).next("div").attr("class","message-length").text(e+"/100")}),AMap.plugin("AMap.Geocoder",function(){if(geocoder=new AMap.Geocoder({}),!lineParam.departCityName){var e={url:window.location.href};wxInitConfig(e,getGpsCallback)}}),$(".startWeekTime").on("click",function(){var e=$(this);initWeekTime(e)})});var geocoder,lineParam={},searchMapAddCallback=function(e){$("#startAddr").val(e.address),$("#currentAddressDetail").html(e.address),$("#currentAddressDetail").attr("data-lng",lineParam.departLng),$("#currentAddressDetail").attr("data-lat",lineParam.departLat),$("#currentAddress").show()},getGpsCallback=function(e){console.log(e.longitude);var a=e.longitude+","+e.latitude;lineParam.departLng=e.longitude,lineParam.departLat=e.latitude;var t=[e.longitude,e.latitude];geoCallBack(1,t),searchAddressByGps(a,searchMapAddCallback),""!=lineParam.arriveLng&&""!=lineParam.arriveLat&&$("#searchBtn").attr("class","search-btn")};