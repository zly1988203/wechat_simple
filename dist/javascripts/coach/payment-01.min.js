var _myIScroll,bindScroll=function(e){_myIScroll&&_myIScroll.destroy(),setTimeout(function(){_myIScroll=new IScroll(e+" .listWrapper")},300)};function passengerHandle(){function e(e){var n=e.prev(".name").find("input[type=checkbox]");n.prop("checked")?n.prop("checked",!1):n.prop("checked",!0),t(n)}function t(e){e.parents("li").data("select",e.prop("checked"))}function n(e){var t=e.parents("li"),n=t.data("name"),a=t.data("phone"),o=t.data("code");$("#editPassenger").popup("push",function(){$("#editPassengerName").val(n),$("#editPassengerPhone").val(a),$("#editPassengerCode").val(o),$("#editPassenger").data("trigger",t.index())})}$("#selectPassengerButton").on("click",function(){$("#passengerList").popup("modal",function(){bindScroll("#passengerList")})}),$("#passengerList .passenger-list li .info").on("click",function(){e($(this))}),$(".passenger-list input[type=checkbox]").on("change",function(){t($(this))}),$("#selectButton").on("click",function(){var e="";$(".passenger-list li").each(function(){var t=$(this);t.data("select")&&(e+='<div class="item"><div class="handle-minus"></div><div class="name">'+t.data("name")+'</div><div class="info"><p><span class="label">手机号</span>'+t.data("phone")+'</p><p><span class="label">身份证</span>'+t.data("code")+"</p></div></div>")}),$("#passengerWrapper .content").html("").append(e),$("#passengerList").closePopup()}),$(".addPassengerButton").on("click",function(){$("#addPassenger").popup("push",function(){$("#name").val(""),$("#phone").val(""),$("#code").val("")})}),$("#cancelAddButton").on("click",function(){$("#addPassenger").closePopup()}),$("#submitAddButton").on("click",function(){var a=$("#addPassengerName").val(),o=$("#addPassengerPhone").val(),c=$("#addPassengerCode").val(),i=$('<li class="sui-border-b" data-select="true" data-name="'+a+'" data-phone="'+o+'" data-code="'+c+'"></li>'),s=$('<div class="name"><input type="checkbox" class="frm-checkbox" checked /></div>'),l=$('<div class="info"><h4>'+a+"</h4><p><em>手机号</em>"+o+"</p><p><em>身份证</em>"+c+"</p></div>"),d=$('<div class="handle"><i class="icon-edit editPassengerButton"></i></div>');i.append(s).append(l).append(d),$("#passengerList .passenger-list").append(i),s.find("input[type=checkbox]").on("change",function(){t($(this))}),d.find(".editPassengerButton").on("click",function(){n($(this))}),l.on("click",function(){e($(this))}),_myIScroll&&_myIScroll.refresh(),$("#addPassenger").closePopup()}),$(".editPassengerButton").on("click",function(){n($(this))}),$("#submitEditButton").on("click",function(){$("#editPassenger").closePopup(function(){var e=$("#editPassenger").data("trigger"),t=$(".passenger-list li").eq(e),n=$("#editPassengerName").val(),a=$("#editPassengerPhone").val(),o=$("#editPassengerCode").val();t.data("name",n).data("phone",a).data("code",o),t.find(".info h4").text(n),t.find(".info p:first").html("</h4><p><em>手机号</em>"+a),t.find(".info p:last").html("</h4><p><em>身份证</em>"+o)})}),$(".operation .icon-minus").on("click",function(){var e=$(this);if(!e.data("clock")){e.data("clock",!0);var t=parseInt(e.next().text());5==t&&e.siblings(".icon-plus").removeClass("out"),1==t||(e.next().text(t-1),1==e.next().text()&&e.addClass("out")),e.data("clock",!1)}}),$(".operation .icon-plus").on("click",function(){var e=$(this);if(!e.data("clock")){e.data("clock",!0);var t=parseInt(e.prev().text());1==t&&e.siblings(".icon-minus").removeClass("out"),5==t||(e.prev().text(t+1),5==e.prev().text()&&e.addClass("out")),e.data("clock",!1)}})}function back(){if(window.history&&window.history.pushState){var e=window.location.href,t=-1;history.pushState({page:1},"page",e),$(window).on("popstate",function(){history.go(t)}),$("#selectPassengerButton, .coupon-toggle, .insurance-toggle, .ticket-rule").on("click.back",function(){t=0}),$("#selectButton, #closeCoupon, #closeInsurance").on("click.back",function(){t=-1})}}$(".listWrapper").each(function(){$(this).css("height",$(window).height()-74+"px")}),$(function(){passengerHandle(),$(".ticket-rule").on("tap",function(e){e.stopPropagation(),$("#ticketRule").popup("modal")}),$(".payment-way li").off("click").on("click",function(){$(this).find("input").prop("checked",!0)}),back(),$(".datepicker-wrapper").datePicker({dateBase:"2017-6-1",gather:[{date:"2017-6-19",comment:"已发车",state:"readonly"},{date:"2017-6-20",comment:"已售罄",state:"readonly"},{date:"2017-6-21",comment:"¥180.00",state:"select"},{date:"2017-6-22",comment:"¥18",state:"select","badge-right":"/dist/images/common/icon-discounts.png","badge-right-active":"/dist/images/common/icon-discounts-active.png"},{date:"2017-6-26",comment:"¥18",state:"select"},{date:"2017-6-27",comment:"¥18",state:"select","badge-right":"/dist/images/common/icon-discounts.png","badge-right-active":"/dist/images/common/icon-discounts-active.png"},{date:"2017-6-28",comment:"¥18",state:"select"},{date:"2017-6-29",state:"disabled"},{date:"2017-6-30",state:"disabled"},{date:"2017-7-4",comment:"¥18",state:"select"}],selectCallback:function(e){$(".pay-handle").find(".day").html(e.selectData.length)}})}),$(".new-btn-bar .detail-btn").off("click").on("click",function(){var e=this;"close"==$(e).data("switch")?($(e).data("switch","open"),$(e).addClass("detail-open"),$("#totalAmount").show()):($(e).data("switch","close"),$(e).removeClass("detail-open"),$("#totalAmount").hide())}),$(".item-banner").off("click").on("click",function(){$("#attIntroduce").popup()}),$(".btn-buy").off("click").on("click",function(){$("#attOrderInfo").popup()}),$(".btn-edit").off("click").on("click",function(){$("#attOrderInfo").popup()}),$(".item-readme").off("click").on("click",function(e){e.stopPropagation(),$("#attReadInfo").popup()}),$(".att-readme").off("click").on("click",function(e){e.stopPropagation(),$("#attReadInfo").popup()}),$(".btn-order-canle").off("click").on("click",function(){$("#attOrderInfo").closePopup()}),$(".btn-order-ok").off("click").on("click",function(){$("#attOrderInfo").closePopup()}),$("#btn-date").on("click",function(){$("#selectDate").popup("plate",function(){console.log("open")},function(e){console.log(e)})}).backtrack({cancel:"#selectDate .sui-popup-mask"});