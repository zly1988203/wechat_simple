function initPage(){var e=39.865042,i=116.379028,t=new AMap.Map("allmap",{resizeEnable:!0,zoom:13,center:[116.397428,39.90923]}),n=[],a=[{icon:"../../dist/images/newInnerCity/icon-current.png",size:[25,50],position:[i,e],offset:[0,25],markerType:0},{icon:"../../dist/images/newInnerCity/icon-start.png",size:[21,32],position:[i,e],offset:[0,0],markerType:1},{icon:"../../dist/images/newInnerCity/icon-end.png",size:[21,32],position:[116.427281,39.903719],offset:[0,0],markerType:2}];function o(e){var i=document.createElement("div");i.className="marker-info-box";var t=document.createElement("div");return t.className="marker-tips",t.innerHTML=e,i.appendChild(t),i}$.each(a,function(e,i){var a=new AMap.Marker({map:t,position:[i.position[0],i.position[1]],icon:new AMap.Icon({size:new AMap.Size(i.size[0],i.size[1]),image:i.icon,imageOffset:new AMap.Pixel(i.offset[0],i.offset[1])})});a.on("click",function(e){1==i.markerType?new AMap.InfoWindow({isCustom:!0,content:o("从这里上车"),offset:new AMap.Pixel(0,-34)}).open(t,e.target.getPosition()):2==i.markerType&&new AMap.InfoWindow({isCustom:!0,content:o("从这里下车"),offset:new AMap.Pixel(0,-34)}).open(t,e.target.getPosition())}),a.emit("click",{target:a}),n.push(a)});t.setFitView()}function judgeService(){var e={cityLine:{price:"",comfortablePrice:"",luxuriousPrice:"",sevenSeatPrice:"",comfortableSeat:"3",luxuriousSeat:"4",businessSeat:"5",upRegionId:"",downRegionId:"",lineName:"",name:"",type:"",id:""},isInfo:"",isCardNo:"",bookTime:"",timeArea:"",activityTag:"",carPool:{price:"",payPrice:"",discount:"",couponPrice:"",specialPrice:"",promoteType:"",sale:"",oldPrice:""},comfortable:{price:"",payPrice:"",discount:"",couponPrice:"",specialPrice:"",promoteType:"",sale:"",oldPrice:""},luxurious:{price:"",payPrice:"",discount:"",couponPrice:"",specialPrice:"",promoteType:"",sale:"",oldPrice:""},business:{price:"",payPrice:"",discount:"",couponPrice:"",specialPrice:"",promoteType:"",sale:"",oldPrice:""}};if(null!=e.isCardNo&&1==e.isCardNo)$("#amount").data("type",1);else{$("#amount").data("type",0);var i=null==e.cityLine.comfortableSeat?0:e.cityLine.comfortableSeat;i<e.cityLine.luxuriousSeat&&(i=e.cityLine.luxuriousSeat),i<e.cityLine.businessSeat&&(i=e.cityLine.businessSeat),$("#amount").data("max",i)}$(".startTime").data("intervalminute",null==e.cityLine.timeArea||""==e.cityLine.timeArea?60:e.cityLine.timeArea);var t=$("#amount").val();t>e.cityLine.comfortableSeat&&(e.comfortable=null),t>e.cityLine.luxuriousSeat&&(e.luxurious=null),t>e.cityLine.businessSeat&&(e.business=null);var n="",a=0;null!=e.carPool&&(n+=createVehicleItem(e.carPool.promoteType,a=1,e.carPool.price,e.carPool.couponPrice)),null!=e.comfortable&&(a=2,n+=createVehicleItem(e.comfortable.promoteType,a,e.comfortable.price,e.comfortable.couponPrice)),null!=e.luxurious&&(a=3,n+=createVehicleItem(e.luxurious.promoteType,a,e.luxurious.price,e.luxurious.couponPrice)),null!=e.business&&(a=4,n+=createVehicleItem(e.business.promoteType,a,e.business.price,e.business.couponPrice)),$(".confirm-container .vehicle-switch-box").html(n),$(".vehicle-item .vehicle-info").on("click",function(){$(this).find("i");$(this).parent().addClass("active").siblings().removeClass("active"),console.log($(this).parents(".vehicle-switch-box"))}),$(".vehicle-item .price-box").on("click",function(){var e=$(this).parent(),i=switchStage($(e).data("stage")),t=$(e).data("price"),n=$(e).data("couponname"),a=$(e).data("couponprice"),o="";o+='<div class="detail-box"><div class="detail-item"><div class="name">'+i+'一口价</div><div class="number">'+t+'元</div></div><div class="detail-item"><div class="name">人数</div><div class="number">'+$("#amount").val()+'人</div></div></div><div class="coupon-box"><div class="coupon-item"><div class="name">'+n+'</div><div class="number">-'+a+"元</div></div></div>",$(".price-detail-container .price-detail-main").html(o),$(".price-detail-container").popup("push")})}function createVehicleItem(e,i,t,n){var a="",o="";1==e&&(o="特价"),2==e&&(o="券已抵扣");var c="";return 1==i?c=" stage-one":2==i?c=" stage-two":3==i?c=" stage-three":4==i&&(c=" stage-four"),a+='<div class="vehicle-item" data-stage="'+i+'" data-price="'+t+'" data-couponname="'+o+'" data-couponprice="'+n+'"><div class="vehicle-info"><div class="name">'+switchStage(i)+'</div><div class="stage-icon'+c+'"><i></i></div></div><div class="price-box"><div class="price">一口价<span>'+t+'元&nbsp;&gt;</span></div><div class="coupon">'+o+n+"元</div></div></div>"}function switchStage(e){var i="";switch(e){case 2:i="舒适型";break;case 3:i="豪华型";break;case 4:i="商务型";break;default:i="拼车"}return i}function showSelectPerson(){$(".select-person-container").show()}function textLength(e){for(var i=0,t=$(e).val(),n=0;n<t.length;n++){var a=t.charCodeAt(n);a>=1&&a<=126||65376<=a&&a<=65439?i++:i+=2}return i}function showEditPersonContainer(e,i){var t="",n="",a=0;null==e&&(e=""),null==i&&(i=""),""==e&&""==i?(n='<div class="title">添加乘车人</div>',a=1):(n='<div class="title">编辑乘车人</div>',a=0),t+='<div class="popup-main"><div class="title-content"><div class="close-edit">取消</div>'+n+'<div class="confirm-btn">确定</div></div><div class="edit-box"><div class="edit-item"><div class="name">姓名</div><input id="personName" class="value" value="'+e+'" placeholder="请输入乘车人姓名"/></div><div class="edit-item"><div class="name">身份证</div><input id="personIDNo" class="value" value="'+i+'" placeholder="请输入乘车人证件号码"/></div></div></div>',$(".edit-person-container").html(t).show(),$(".edit-person-container .close-edit").on("click",function(){$(".select-person-container").show(),$(".edit-person-container").hide()}),$(".edit-person-container .confirm-btn").on("click",function(){var e=$("#personName").val(),i=$("#personIDNo").val();""==e?$.toast("请输入乘车人姓名"):""==i?$.toast("请输入乘车人证件号码"):checkIDCard(i)?""!=e&&""!=i&&checkIDCard(i)&&(confirmEditPerson(e,i,a),$(".select-person-container").show(),$(".edit-person-container").hide()):$.toast("请输入正确的乘车人证件号码")})}function confirmEditPerson(e,i,t){}function checkIDCard(e){for(var i=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],t=e+"",n=e[17],a=t.substring(0,17).split(""),o=a.length,c=0,s=0;s<o;s++)c+=a[s]*i[s];var r=["1","0","X","9","8","7","6","5","4","3","2"][c%11],l=/^[1-9][0-9]{5}([1][9][0-9]{2}|[2][0][0|1][0-9])([0][1-9]|[1][0|1|2])([0][1-9]|[1|2][0-9]|[3][0|1])[0-9]{3}([0-9]|[X])$/.test(e);return!(n!==r||!l)}function showSharingCarPrice(){}$(function(){$(".notes").on("focus",function(){$(this).attr("placeholder","")}),$(".notes").on("blur",function(){$.trim($(this).val())?$(this).attr("placeholder",""):($(this).val(""),$(this).attr("placeholder","给司机留言"))}),initPage(),judgeService(),$("#currLocation").on("click",function(){})}),$(".market-rules-btn").on("click",function(){$(".market-rule-container").popup("modal")}),$(".tips-btn").on("click",function(){$(".tips-container-popup").show()}),$(".popup-container .close").on("click",function(){$(".popup-container").hide()}),$("#closeButton").on("click",function(){$(".price-detail-container").closePopup()}),$("#amount").on("click",function(){var e=$(this).data("type"),i=$(this).data("max");if(1==e)showSelectPerson();else{for(var t=[],n=1;n<i+1;n++){var a={value:n,text:n};t.push(a)}$.selectPicker({title:"选择出行人数",data:t,current:$("#present_peopleNumber").data("value"),onChange:function(e,i){var t=$("#amount");t.val()!=i&&t.data("value",e).val(i).trigger("change")}})}}),$(".notes-box textarea").on("input",function(){var e=parseInt($(this).data("maxlength"));textLength($(this))>e&&$(this).val($(this).val().substring(0,e))}),$(".selection").on("click",function(){var e=$(this).attr("class"),i=$(".select-person-main .title .selected").data("value");-1==e.indexOf("active")?($(this).addClass("active"),$(this).parent().data("selected",!0),i++):($(this).removeClass("active"),$(this).parent().data("selected",!1),i--),$(".select-person-main .title .selected").html(i),$(".select-person-main .title .selected").data("value",i)}),$(".select-person-container .confirm-btn").on("click",function(){var e=$(".select-person-main .title .selected").data("value"),i=[],t="";if(e<=0)$.toast("请选择乘车人");else{$("#amount").val(e);var n=$(".select-person-container .person-box .person-item");$.each(n,function(e,n){var a={};$(n).data("selected")&&(a.name=$(n).data("name"),a.idno=$(n).data("idno"),i.push(a),t+='<input type="hidden" data-id="" data-name="'+$(n).data("name")+'" data-idno="'+$(n).data("idno")+'" />')}),$("#personList").html(t),$(".select-person-container").hide()}}),$(".person-item .edit-btn").on("click",function(){$(".select-person-container").hide();var e=$(this).parent();showEditPersonContainer($(e).data("name"),$(e).data("idno"))}),$(".add-person").on("click",function(){$(".select-person-container").hide(),showEditPersonContainer()}),$(".startTime").on("click",function(){var e=$(this);initCityTimePicker(e)});var winHeight=$(window).height();$(window).resize(function(){var e=$(this).height();winHeight-e>50?$(".confirm-container").hide():$(".confirm-container").show()});