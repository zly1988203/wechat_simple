var preOrderInfo={selectData:[],busIds:"",qrcId:""};function getCalendarList(){var e={token:serverUtil.token,scheduleId:"",startStationId:"",endStationId:"",departDate:""};request(commuteApi.calendarList,e).then(function(e){if(0==e.code){var t=e.data;t.scheduleInfoList.length>0?(t.scheduleInfoList.forEach(function(e,t){e.comment="¥"+e.sellPrice,e.status="select",0==e.hasWork?e.tag="休":e.tag="班",0==e.ticketRemainNum&&(e.comment="售罄",e.status="readonly"),0==e.busStatus&&(e.comment="已停售",e.status="readonly"),-1==e.busStatus&&(e.status="readonly"),-1!=e.id&&-2!=e.id||(e.comment="未排班",e.status="readonly"),1==e.hasBought&&(e.comment="已购票",e.status="readonly"),1==e.specialState&&0!=e.ticketRemainNum&&e.busStatus>0&&(e.badge="/src/images/common/icon-discounts.png")}),initDatePicker(t.scheduleInfoList)):initDatePicker([])}})}function getLocalTime(e){var t=new Date(e),a=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()<10?"0"+t.getDate():t.getDate();return t.getFullYear()+"-"+a+"-"+n}function initDatePicker(e){var t=getLocalTime((new Date).getTime());$(".date-picker-container").datePicker({dateBase:t,switchMonth:a,gather:e,selectCallback:function(e){preOrderInfo.selectData=e.selectData}});var a=function(e,t){setTimeout(function(){t&&(t.reset({gather:[{date:"2019-08-05",comment:"有票",status:"select",label:"端午",badge:""},{date:"2019-08-09",comment:"有票",status:"select",tag:"休",badge:""}]}),t.drawMonth(e))},600)}}$(".back-btn").on("click",function(){window.history.go(-1)}),$(".confirm-btn").on("click",function(){var e={token:serverUtil.token,busId:""};request(commuteApi.queryNotPayOrders,e).then(function(e){if(0==e.code)preOrderInfo.selectData.forEach(function(e,t){preOrderInfo.busIds+=e.id+","}),postPage("/commutingBus/toAddOrder",[{name:"busIds",value:preOrderInfo.busIds},{name:"qrcId",value:preOrderInfo.qrcId}]);else if(50086==e.code){var t=e.data;$.confirm("您当前有未支付订单，不能重复下单","提示",["我知道了","进入订单"],function(){window.location.href="/bus/toCommuteOrderDetail?orderNo="+t})}else $.alert(e.message||"未知错误")})}),$(function(){getCalendarList()});