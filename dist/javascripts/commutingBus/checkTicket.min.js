var TICKET_STATUS={CHECKED:"1",REFUNDED:"3",TO_RIDE:"2"},userInfo=JSON.parse(localStorage.getItem("userInfo"));function init(){userInfo=JSON.parse(localStorage.getItem("userInfo")),queryDetailByOrderNo(function(e){var t=createElementObj(e);t.length>0&&showElement(t)})}function getElementToPageTop(e){return e.parentElement?this.getElementToPageTop(e.parentElement)+e.offsetTop:e.offsetTop}function setFooterPosition(){var e=document.documentElement.clientHeight;getElementToPageTop(document.getElementById("heightPoint"))>=e-10?$("footer").css({position:"relative","margin-top":".75rem"}):$("footer").css({position:"fixed","margin-top":".75rem"})}function showElement(e){var t=$(".order-content");e.forEach(function(e){var i='<div class="order-item">'+('<div class="order-top">  <div class="head">    <div class="time">'+formatDateToString(new Date(e.ticketTime),!0)+'</div>    <div class="line-name">'+e.scheduleCode+'</div>    <div class="license-plate">'+e.carNo+'</div>  </div>  <div class="station">    <div class="station-item departure">'+e.departCity+e.departStation+'</div>    <div class="station-item arrival">'+e.arriveCity+e.arriveStation+"</div></div></div>")+'<div class="checkanimat"></div><div class="order-bottom"></div></div>';$(t).append(i),showTicketList(e.ticketInfoList),"1"==getUrlParams().ifQuickCheck?$(".checkanimat").flightChart({flights:["/src/images/commutingBus/check-animat/01.png","/src/images/commutingBus/check-animat/02.png","/src/images/commutingBus/check-animat/03.png","/src/images/commutingBus/check-animat/04.png","/src/images/commutingBus/check-animat/05.png","/src/images/commutingBus/check-animat/06.png","/src/images/commutingBus/check-animat/07.png","/src/images/commutingBus/check-animat/08.png"],flightSpeed:3,text:e.code}):$(".checkanimat").hide(),setTimeout(function(){setFooterPosition()},0)})}function createElementObj(e){var t=[],i=[],a=[];return e.forEach(function(e){var s={};a.includes(e.orderNo)?(i.push({verifyCode:e.verifyCode,idCardNo:e.idCardNo,passengerName:e.passengerName,ticketSerialNo:e.ticketSerialNo,status:e.status}),s.ticketInfoList=i):(a.push(e.orderNo),s=e,i.push({verifyCode:e.verifyCode,idCardNo:e.idCardNo,passengerName:e.passengerName,ticketSerialNo:e.ticketSerialNo,status:e.status}),s.ticketInfoList=i,t.push(s))}),t}function queryDetailByOrderNo(e){var t=getUrlParams(),i={orderNo:t.orderNo,departDate:t.departDate,clientType:serverUtil.clientType,appId:serverUtil.appId,token:serverUtil.token,appVersion:serverUtil.appVersion,timestamp:(new Date).getTime(),deviceId:serverUtil.deviceId,wechatLogin:serverUtil.wechatLogin};request(commuteApi.queryDetailByOrderNo,i).then(function(t){if(0==t.code&&e&&"function"==typeof e)if(null!=t.data&&null!=t.data){e(t.data);var i=new Date(t.data[0].ticketTime);countDown(new Date(t.timestamp),i)}else e([])})}function countDown(e,t){var i=format((t.getTime()-e.getTime())/1e3);console.log(i);var a=setInterval(function(){i.second>0?i.second--:i.minute>0?(i.minute--,i.second=59):i.hour>0?(i.hour--,i.minute=59,i.second=59):(i.second=0,clearInterval(a)),fullCount(i)},1e3)}function fullCount(e){var t=$(".header-tips");if(null==e.hour&&(e.hour=0),null==e.minute&&(e.minute=0),e.hour<=0&&e.minute<=0&&e.second<=0)$(t).hide();else{var i="还剩"+e.hour+"小时"+e.minute+"分"+e.second+"秒上车";$(t).text(i),$(t).show()}}function getUrlParams(){var e=window.location.href;return{orderNo:getParam("orderNo",e),departDate:getParam("departDate",e),ifQuickCheck:"1"}}function showTicketList(e){var t=$(".order-bottom"),i="",a="";if(e.forEach(function(e,t){i+='<li data-status="'+e.status+'">  <div class="check-in-tips">验票码</div>  <div class="check-in-code">'+e.verifyCode+'</div>  <div class="ticket-info">    <div>票号：'+e.ticketSerialNo+'</div>  </div>  <div class="status '+getStatusClassName(e.status)+'"></div></li>',a+=0==t?'<span class="active"></span>':"<span></span>"}),e.length<=1)var s='<div class="slider-box"><div class="ticket-list slider">  <ul class="slider-main clearfloat">'+i+"  </ul></div></div>";else s='<div class="slider-box"><div class="ticket-list slider">  <ul class="slider-main clearfloat">'+i+'  </ul></div><div class="list-index">'+a+"</div></div>";$(t).append(s);var n=$(".order-bottom").width();$(".slider-main li").width(n+"px"),$(".slider").width(n+"px").css({overflow:"hidden"}),$(".slider-main").width(n*e.length+"px"),sliderCheckNo(e.length,n)}function sliderCheckNo(e,t){var i,a,s,n,o,r,c=1,d=$(".slider-main");$(".slider-main li").on("touchstart",function(e){i=e.touches[0].pageX,a=e.touches[0].pageY}),$(".slider-main li").on("touchend",function(l){s=l.changedTouches[0].pageX,n=l.changedTouches[0].pageY,o=s-i,r=n-a,Math.abs(o)>Math.abs(r)&&o>0?c>1&&(c--,d.css({left:-t*(c-1)+"px"})):Math.abs(o)>Math.abs(r)&&o<0&&c<e&&(c++,d.css({left:-t*(c-1)+"px"}));var u=$(".list-index").children("span")[c-1];$(u).addClass("active").siblings().removeClass()})}function getStatusClassName(e){var t="";return e==TICKET_STATUS.CHECKED?t="checked":e==TICKET_STATUS.REFUNDED?t="refunded":e==TICKET_STATUS.TO_RIDE&&(t="toride"),t}$(function(){init()});