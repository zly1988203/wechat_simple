var clickEvent=isAndroid()?"tap":"click",lineParam={},stationType=1,providerId="",isLocation=!1;function getGpsCallback(a){if(0!=a.flag){var e=a.longitude+","+a.latitude;$("#currentAddressDetail").attr("data-lng",a.longitude),$("#currentAddressDetail").attr("data-lat",a.latitude),request(commonApi.getGpsLocation,{gps:e}).then(function(a){if(0==a.code){var e=a.data;$("#currentAddressDetail").data("city-name",e.cityName),$("#currentAddressDetail").data("area-name",e.areaName),$("#currentAddressDetail").data("area-id",e.areaId),$("#currentAddressDetail").data("address",e.address),$("#currentAddressDetail").html(e.address),$("#currentAddress").show()}else $("#currentAddress").hide()})}else isLocation=!1}function drawSchedulHtml(a){for(var e="",t=0;t<a.length;t++){var i="",r=a[t],n=getFormatTime(r.departTime);i=0==n.timeDiff?"今天("+n.week+")":1==n.timeDiff?"明天("+n.week+")":n.month+"-"+n.day+"("+n.week+")";var s=n.hour+":"+n.minute;e+='<div class="swiper-slide">   <div class="content">    <div class="startAdrs">        <div class="addr adrs">'+r.departTitle+'</div>        <div class="addr area">'+r.departCity+'</div>    </div>    <div class="center-line">        <div class="time">'+i+'</div>        <div class="line"></div>        <div class="time">'+s+'</div>    </div>    <div class="endAdrs">        <div class="addr adrs">'+r.arriveTitle+'</div>        <div class="addr area">'+r.arriveCity+"</div>    </div>   </div></div>"}$("#scheduling-panle .swiper-wrapper").html(e),swSchedulingList(a)}function swSchedulingList(a){new Swiper("#scheduling-panle .swiper-container",{spaceBetween:10,pagination:{el:"#scheduling-panle .swiper-pagination"}});1==a.length?$(".scheduling .swiper-pagination").hide():$(".scheduling .swiper-pagination").show(),$(".scheduling .swiper-container").on("click mousedown",function(a){})}function drawOrderList(a){for(var e="",t=0;t<a.length;t++){var i=a[t];e+='<div class="content"><div class="icon iconfont icon-history_icon location"  data-departStationId="'+i.departStationId+'" data-arriveStationId="'+i.arriveStationId+'" data-departTime="'+i.departTime+'"></div>            <div class="startAdrs" data-depart="'+i.departTitle+'">                <div class="addr adrs">'+i.departTitle+'</div>                <div class="addr area">'+i.departCity+'</div>            </div>            <div class="center-line">                <span class="icon iconfont icon-one_way_arrow_icon arrow"></span>            </div>            <div class="endAdrs" data-arrive="'+i.arriveTitle+'">                <div class="addr adrs">'+i.arriveTitle+'</div>                <div class="addr area">'+i.arriveCity+'</div>            </div>            <div class="btn-list">                <div class="call-car" data-busId="'+i.busId+'">购票</div>                <div class="back">返程</div>            </div></div>',t+1!=a.length&&(e+='<div class="line"></div>')}$(".near-order").html(e);$(".call-car").on(clickEvent,function(){var a=$(this).parent().siblings(".location"),e={departStationId:$(a).data("departstationid"),arriveStationId:$(a).data("arrivestationid"),departTime:$(a).data("departtime")};sessionStorage.setItem("stationInfo",JSON.stringify(e)),window.location="/cityBus/lineListCityBus?searchType=4"}),$(".back").on(clickEvent,function(){var a=$(this).parent().siblings(".location"),e={departStationId:$(a).data("arrivestationid"),arriveStationId:$(a).data("departstationid"),departTime:$(a).data("departtime")};sessionStorage.setItem("stationInfo",JSON.stringify(e)),window.location="/cityBus/lineListCityBus?searchType=4"})}function getFormatTime(a){var e=new Date(parseInt(a)),t=new Date;t=new Date(t.getFullYear(),t.getMonth(),t.getDate());var i=(new Date(e.getFullYear(),e.getMonth(),e.getDate())-t)/1e3/60/60/24;return{year:e.getFullYear(),month:formatNumber(e.getMonth()+1),day:formatNumber(e.getDate()),hour:formatNumber(e.getHours()),minute:formatNumber(e.getMinutes()),seconds:formatNumber(e.getSeconds()),week:getTheWeek(e),timeDiff:i}}function formatNumber(a){return 1==(a+"").length&&a<10&&(a="0"+a),a}function getTheWeek(a){var e="";return 0==a.getDay()?e="周日":1==a.getDay()?e="周一":2==a.getDay()?e="周二":3==a.getDay()?e="周三":4==a.getDay()?e="周四":5==a.getDay()?e="周五":6==a.getDay()&&(e="周六"),e}function searchLine(){lineParam.departAreaId&&lineParam.arriveAreaId&&(sessionStorage.setItem("stationInfo",JSON.stringify(lineParam)),window.location="/cityBus/lineListCityBus?searchType=2")}var _myIScrollsa,_isInitsa=!1;function changeCityClickEvent(){$(".current-city").off(clickEvent).on(clickEvent,function(){$("#searchResult").html(""),$(".search-input input").val("");var a=$(".current-city span").text();$("#currAreaCode").val();$("#select-Citys").setPopupData(a),$("#select-Citys").closePopup(function(){_myIScrollsc&&(_myIScrollsc.destroy(),_myIScrollsc=null)})})}$(".select-city-btn").on(clickEvent,function(){var e=$(this);$("#areaCityPanel .area-content").html(""),$("#areaCityPanel").hide(),"startAddr"==e.attr("id")?(stationType=1,$("#stationType").val("start")):(stationType=2,$("#stationType").val("end")),getHistoryStation(stationType),getOpenAreas(stationType),changeCityClickEvent(),$("#search-address").popup("push",function(){setTimeout(function(){$("#search-address .wrapper").css("height",$(window).height()-44),_myIScrollsa=new IScroll("#searchWrapper")},300)},function(a){e.val(a.name),searchLine()})}),$("#search-address #closeBtn").on("click",function(){$("#search-address").closePopup(function(){_myIScrollsa&&(_isInitsa=!1,_myIScrollsa.destroy(),_myIScrollsa=null)})});var cpLock=!0;_isInitsa=!1;function searchResultClickEvent(){$("#searchWrapper li").off("tap").on("tap",function(){var e={name:$(this).data("cityname")+"·"+$(this).data("name"),stationName:$(this).data("name"),cityName:$(this).data("cityname"),address:$(this).data("address"),lat:$(this).data("lat"),lng:$(this).data("lng"),areaid:$(this).data("areaid"),cityId:""};"start"==$("#stationType").val()?(lineParam.departAreaName=e.name,lineParam.departLng=e.lng,lineParam.departLat=e.lat,lineParam.departAreaId=e.areaId):(lineParam.arriveAreaName=e.name,lineParam.arriveLng=e.lng,lineParam.arriveLat=e.lat,lineParam.arriveAreaId=e.areaId),saveSearchRecord(e,function(a){"start"==$("#stationType").val()?(lineParam.departAreaId=a.areaId,lineParam.departCityId=a.cityId):(lineParam.arriveAreaId=a.areaId,lineParam.arriveCityId=a.cityId),hideSearchAddressResult(),$("#search-address").setPopupData(e),$("#search-address").closePopup(function(){_myIScrollsa&&(_isInitsa=!1,_myIScrollsa.destroy(),_myIScrollsa=null)})})})}function saveSearchRecord(a,e){var t={token:serverUrl.token,lat:a.lat,lng:a.lng,address:a.stationName+"#"+a.address+"#"+a.areaCode,businessType:7,stationType:0};request(commuteApi.saveSearchStation,t).then(function(a){0==a.code&&e(a.data)})}$("#textSearchMap").focus(function(){showSearchAddressPanel()}).off("input").on({compositionstart:function(){cpLock=!1},compositionend:function(){cpLock=!0},input:function(){setTimeout(function(){if(cpLock){var d=$.trim($("#textSearchMap").val());AMap.service(["AMap.PlaceSearch"],function(){var a={pageSize:8,pageIndex:1,city:$("#areaCode").val(),extensions:"all",citylimit:!1,type:"汽车服务|汽车销售|汽车维修|摩托车服务|餐饮服务|购物服务|生活服务|体育休闲服务|医疗保健服务|住宿服务|风景名胜|商务住宅|政府机构及社会团体|科教文化服务|交通设施服务|金融保险服务|公司企业|道路附属设施|地名地址信息|公共设施"};placeSearch=new AMap.PlaceSearch(a),placeSearch.search(d,function(a,e){var t=[];d.length<=0&&(a="no_data"),"complete"==a&&(t=e.poiList.pois);for(var i="",r=0;r<t.length;r++){var n=t[r].name.replace(d,'<span class="imp-blue">'+d+"</span>"),s=t[r].pname+""+t[r].cityname+t[r].adname+t[r].address;s=s.replace(d,'<span class="imp-blue">'+d+"</span>"),i+='<li data-areaid="'+t[r].adcode+'" data-name="'+t[r].name+'" data-address="'+t[r].address+'" data-cityname="'+t[r].cityname+'"  data-lat="'+t[r].location.lat+'" data-lng="'+t[r].location.lng+'"><span class="icon iconfont icon-historical_location_icon"></span><div class="sui-cell-map"><div class="address">'+n+'</div><div class="city-area">'+s+"</div></div></li>"}$("#searchWrapper ul").html(i),searchResultClickEvent()})})}},0)}});var _myIScrollsc,showSearchAddressPanel=function(){if($("#mapResult").show(),$("#adrsResult").hide(),$("#cancelBtn").show(),$("#closeBtn").hide(),!_isInitsa){_isInitsa=!0;var t=0,i=0;$("#searchWrapper").on("touchstart",function(){i=$(this).scrollTop(),t=event.touches[0].pageY}),$("#searchWrapper").on("touchmove",function(a){var e=t-a.touches[0].pageY;$(this).scrollTop(e+i)})}},hideSearchAddressResult=function(){$("#mapResult").hide(),$("#adrsResult").show(),$("#cancelBtn").hide(),$("#closeBtn").show(),$("#textSearchMap").val("")};function getHistoryStation(a){var e={businessType:7,token:serverUtil.token,stationType:a};request(commuteApi.getHistoryStation,e).then(function(a){if(0==a.code){var e=a.data;if(0==e.length)return void $(".historySearch").hide();$(".historySearch").show(),drawHistoryStation(e)}})}function drawHistoryStation(a){var e="";$("#historyStation").html("");for(var t=0;t<a.length;t++){var i=a[t],r=i.address.split("#");e+='<div class="address" data-areaId="'+i.areaId+'" data-lng="'+i.longitude+'" data-city="'+r[2]+'" data-area="'+r[3]+'" data-lat="'+i.latitude+'" data-city-id="'+i.cityId+'">     <span class="icon iconfont icon-historical_location_icon"></span>    <div class="address-name">'+r[0]+'</div>    <div class="address-detail">'+r[1]+"</div></div>"}$("#historyStation").html(e),historyStationClickEvent(),$("#historySearch").show()}function historyStationClickEvent(){$("#historySearch .station-group .address").off(clickEvent).on(clickEvent,function(){var a={};a.city=$(this).data("city"),a.areaName=$(this).data("area"),a.name=$(this).data("city")+" · "+$(this).find(".address-name").text(),a.address=$(this).find(".address-detail").text(),a.lng=$(this).data("lng"),a.lat=$(this).data("lat"),a.areaId=$(this).data("areaid"),a.cityId=$(this).data("city-id"),"start"==$("#stationType").val()?(lineParam.departAreaName=a.areaName,lineParam.departCityName=a.city,lineParam.departAreaId=a.areaId,lineParam.departLng=a.lng,lineParam.departLat=a.lat):(lineParam.arriveAreaName=a.areaName,lineParam.arriveCityName=a.city,lineParam.arriveAreaId=a.areaId,lineParam.arriveLng=a.lng,lineParam.arriveLat=a.lat),$("#search-address").setPopupData(a),$("#search-address").closePopup(function(){_myIScrollsa&&(_isInitsa=!1,_myIScrollsa.destroy(),_myIScrollsa=null)})})}function getOpenAreas(t){var a={token:serverUtil.token,departAreaId:1,departCityName:"",arriveAreaId:2,arriveCityName:"",lineType:2,stationType:t,providerId:"",seachType:""};request(commuteApi.getOpenAreas,a).then(function(a){if(0==a.code){var e=[];if(0<(e=1==t?null!=a.data.startCityList?a.data.startCityList:[]:null!=a.data.endCityList?a.data.endCityList:[]).length){drawOpenAreas(e,t);$("#areaCityPanel").show()}}})}function chooseCityOrArea(){$("#areaCityPanel .station-group span").off(clickEvent).on(clickEvent,function(){var a=$(this),e=a.parent().prev(".subtitle").text(),t=a.text(),i=(a.attr("class"),a.attr("data-area"));"start"==$("#stationType").val()?(lineParam.departAreaName=t,lineParam.departCityName=e,lineParam.departAreaId=i,lineParam.departLng="",lineParam.departLat=""):(lineParam.arriveAreaName=t,lineParam.arriveCityName=e,lineParam.arriveAreaId=i,lineParam.arriveLng="",lineParam.arriveLat="");var r={};r.name=e+" · "+t,r.areaId=i,$("#search-address").setPopupData(r),$("#search-address").closePopup(function(){_myIScrollsa&&(_isInitsa=!1,_myIScrollsa.destroy(),_myIScrollsa=null)})})}function drawOpenAreas(a,e){for(var t=0;t<a.length;t++){var i="",r=a[t];i+='<h5 class="subtitle">'+r.name+"</h5>",i+='<div class="station-group"><span data-area="'+r.areaId+'" data-station-type="'+e+'">全部地区</span>';for(var n=0;n<r.childrenAreaList.length;n++){var s=r.childrenAreaList[n];s.name&&(i+='<span data-area="'+s.areaId+'" data-station-type="'+e+'">'+s.name+"</span>")}i+="</div>",$("#areaCityPanel .area-content").append(i),chooseCityOrArea()}}$("#cancelBtn").on(clickEvent,function(){hideSearchAddressResult()});var bindScrollsc=function(a){_myIScrollsc&&(_myIScrollsc.destroy(),_myIScrollsc=null),setTimeout(function(){$("#select-Citys .wrapper").css("height",$(window).height()),_myIScrollsc=new IScroll(a+" .wrapper"),retrieveWord(function(a){_myIScrollsc.scrollToElement(a.attr("href"))}),_myIScrollsc&&_myIScrollsc.refresh()},300)};function retrieveWord(t){var a=$(".nav-city"),e=a.find("li"),i=0;e.each(function(){i+=$(this).height()}),a.css("height",i),$(".nav-city a").on(clickEvent,function(a){a.preventDefault();var e=$(this).text();$(".pop-special").text(e).fadeIn().css("opacity","0.6"),setTimeout(function(){$(".pop-special").fadeOut()},1200),t instanceof Function&&t($(this)),_myIScrollsc&&_myIScrollsc.refresh()})}function initOpenCity(){var a={token:serverUtil.token,departAreaId:lineParam.departAreaId,departCityName:lineParam.departCityName,arriveAreaId:lineParam.arriveAreaId,arriveCityName:lineParam.arriveCityName,lineType:2,stationType:stationType,providerId:"",seachType:0};request(commuteApi.getOpenCitys,a).then(function(a){if(0==a.code){var e=a.data;0<e.length&&(drawOpenCityList(e),bindScrollsc("#select-Citys"))}})}function drawOpenCityList(a){var e="";for(i=0;i<a.length;i++){var t=a[i];if(0<$("#city"+t.firstLetter).length)$("#"+t.name).length<=0&&(e='<li id="'+t.name+'" data-area-code="'+t.areaCode+'" data-city-id="'+t.areaId+'">'+t.name+"</li>",$("#city"+t.firstLetter).append(e));else{e='<div class="sui-list-title" id="#city'+t.firstLetter+'">'+t.firstLetter+'</div><ul id="city'+t.firstLetter+'" class="sui-list"><li id="'+t.name+'" data-area-code="'+t.areaCode+'" data-city-id="'+t.areaId+'">'+t.name+"</li></ui>",$("#cityWrapper .city-list").append(e);var r='<li><a href="#city'+t.firstLetter+'">'+t.firstLetter+"</a></li>";$(".nav-city").append(r)}$("#cityWrapper li").off("tap").on("tap",function(){$("#searchResult").html(""),$(".search-input input").val("");var a=$(this).data("area-code"),e=$(this).data("city-id"),t=$(this).text();$("#areaCode").val(a),$("#cityId").val(e),$("#search-address .search-bar .search-input").css("background","#FFFFFF"),$("#search-address .search-bar .search-input input").css("background","#FFFFFF"),$("#search-address .search-bar .search-input input").val("").removeAttr("disabled"),$("#currentAddress").hide(),$("#select-Citys").setPopupData(t),$("#select-Citys").closePopup(function(){_myIScrollsc&&(_myIScrollsc.destroy(),_myIScrollsc=null)})})}}$("#setCityButton").on(clickEvent,function(){var e=$(this);$("#select-Citys").popup("push",function(){initOpenCity()},function(a){e.text(a)})});var sLock=!0;function getFutureOrderList(){var a={businessType:7,token:serverUtil.token};request(commuteApi.getFutureOrderList,a).then(function(a){if(0==a.code){var e=a.data;if(0==e.length)return void $(".scheduling").hide();$(".scheduling").show(),drawSchedulHtml(e)}})}function getLatelyOrderList(){var a={businessType:7,token:serverUtil.token};request(commuteApi.getLatelyOrderList,a).then(function(a){if(0==a.code){var e=a.data;if(0==e.length)return void $(".near-order").hide();$(".near-order").show(),drawOrderList(e)}})}function getAdList(){var a={provider_id:"",position_code:"index-banner",operator_id:serverUtil.token};request(commuteApi.getAdList,a).then(function(a){if(0==a.code){var e=a.list;if(0==e.length)return void $("#swpBanner").hide();$("#swpBanner").show(),drawAdList(e)}})}function drawAdList(a){a.forEach(function(a,e){var t='<div class="swiper-slide" data-id="'+a.id+'" data-href='+a.target_url+'><a class="vert-href" href="javascript:void(0)" data-href='+a.target_url+'><img width="100%" height="100%" src='+a.img_url+"></a></div>";$("#swpBanner .swiper-wrapper").append(t)}),swAdList(a)}function swAdList(a){new Swiper("#swpBanner .swiper-container",{spaceBetween:10,pagination:{el:"#swpBanner .swiper-pagination"}});1==a.length?$("#swpBanner .swiper-pagination").hide():$("#swpBanner .swiper-pagination").show(),$("#swpBanner .swiper-container .swiper-slide").on("click mousedown",function(a){var e=$(this),t={id:e.data("id"),operator_id:""},i=e.data("href");adClicked(t),window.location=i})}function adClicked(a){request(commuteApi.adClicked,a).then(function(a){a.code})}function getHotLineList(){request(commuteApi.getHotLine,{}).then(function(a){if(0==a.code){var e=a.data;if(0==e.length)return void $("#hotLine").hide();$("#hotLine").show(),drawHotLineList(e)}initFooter()})}function drawHotLineList(a){a.forEach(function(a,e){var t="";1==a.haveSpeacial&&(t='<span class="icon iconfont icon-Special_price_icon"></span>');var i='<div class="hotline" haveSpeacial="'+a.haveSpeacial+'" lineId="'+a.id+'"                lineName="'+a.lineName+'">'+t+a.lineName+"                    </div>";$("#hotLine .line-list").append(i)});$(".hotline").on(clickEvent,function(){var a=$(this).attr("lineid"),e=$(this).attr("lineName");null!=e&&""!=e&&(window.location="/cityBus/lineListCityBus?lineId="+a+"&searchType=1")})}function initFooter(){$("footer .provider-name").text("中交出行"),$("footer .provider-tips").text("安全便捷的线上出行平台")}function checkCityIsOpen(){var a=$("#setCityButton").text();initPlaceSearch(),placeSearch.search(a,function(a,e){if("complete"===a&&"OK"===e.info){var t={providerId:providerId,lineType:2},i=e.poiList.pois[0].location;t.lng=i.lng,t.lat=i.lat,request(commuteApi.getIsOpenCity,t).then(function(a){0==a.code&&(a.data?($("#currentAddress").show(),$("#search-address .search-bar .search-input").css("background","#FFFFFF"),$("#search-address .search-bar .search-input input").val("").removeAttr("disabled")):($("#currentAddress").hide(),$("#search-address .search-bar .search-input").css("background"," #F2F2F2"),$("#search-address .search-bar .search-input input").val("当前城市未开通线路").attr("disabled","disabled").css("background","#F2F2F2")))})}else $("#currentAddress").hide(),$("#search-address .search-bar .search-input").css("background"," #F2F2F2"),$("#search-address .search-bar .search-input input").val("当前城市未开通线路").attr("disabled","disabled").css("background","#F2F2F2")})}function initPlaceSearch(){AMap.service(["AMap.PlaceSearch"],function(){var a={pageSize:10,pageIndex:1,city:$("#areaCode").val(),extensions:"all",type:"汽车服务|汽车销售|汽车维修|摩托车服务|餐饮服务|购物服务|生活服务|体育休闲服务|医疗保健服务|住宿服务|风景名胜|商务住宅|政府机构及社会团体|科教文化服务|交通设施服务|金融保险服务|公司企业|道路附属设施|地名地址信息|公共设施"};placeSearch=new AMap.PlaceSearch(a)})}function searchMapAddCallback(a){var e=a.addressComponent.citycode;$("#setCityButton").html(a.cityName),$(".current-city span").html(a.cityName),$("#areaCode").val(e),$("#currAreaCode").val(e),initPlaceSearch(),$("#currentAddressDetail").attr("data-city",a.cityName),$("#currentAddressDetail").attr("data-area",a.areaName),$("#currentAddressDetail").attr("data-cityId",a.cityId),$("#currentAddressDetail").attr("data-areaId",a.areaId),$("#currentAddressDetail").html(a.address),$(".startAddr").val(a.city+" · "+a.address),$(".gather").show(),$("#currentAddress").show()}$("#select-Citys .search-input input").off("input").on({compositionstart:function(){sLock=!1},compositionend:function(){sLock=!0},input:function(){setTimeout(function(){if(sLock){var e="",t=$("#select-Citys .search-input input").val();t=$.trim(t.toLowerCase()),$("#cityWrapper .sui-list-title").show(),$("#select-Citys li").show(),""!=t&&null!=t&&$("#cityWrapper ul").each(function(){var a=!1;$(this).index();$(this).find("li").each(function(){-1!=$(this).text().indexOf(t)?($(this).show(),a=!0):$(this).hide()}),a||(e=$(this).prev().text(),$(this).prev().hide(),a=!1),$(".nav-city").find("li").each(function(){$(this).text()==e&&$(this).hide()})})}},0)}}),$("#select-Citys #closeCitys").on("click",function(){$("#select-Citys").closePopup(function(){_myIScrollsc&&(_myIScrollsc.destroy(),_myIScrollsc=null)})}),$(function(){AMap.plugin("AMap.Geocoder",function(){}),getFutureOrderList(),getLatelyOrderList(),getAdList(),getHotLineList();request(commonApi.getGpsLocation,{gps:""}).then(function(a){if(0==a.code){var e=a.data;$("#currentAddressDetail").data("city-name",e.cityName),$("#currentAddressDetail").data("area-name",e.areaName),$("#currentAddressDetail").data("area-id",e.areaId),$("#currentAddressDetail").data("address",e.address),$("#currentAddressDetail").html(e.address),$("#currentAddress").show()}else $("#currentAddress").hide();checkCityIsOpen(),$("#currentAddressDetail").off(clickEvent).on(clickEvent,function(){var a=$(this),e={};e.name=a.data("city-name")+" · "+a.data("address"),e.lng=a.data("lng"),e.lat=a.data("lat"),e.areaId=a.data("area-id"),"start"==$("#stationType").val()?(lineParam.departAreaName=a.data("area-name"),lineParam.departCityName=a.data("city-name"),lineParam.departAreaId=a.data("area-id"),lineParam.departLng="",lineParam.departLat=""):(lineParam.arriveAreaName=a.data("area-name"),lineParam.arriveCityName=a.data("city-name"),lineParam.arriveAreaId=a.data("area-id"),lineParam.arriveLng="",lineParam.arriveLat=""),$("#search-address").setPopupData(e),$("#search-address").closePopup(function(){_myIScrollsa&&(_isInitsa=!1,_myIScrollsa.destroy(),_myIScrollsa=null)})})})});