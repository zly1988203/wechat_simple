var TICKET_STATUS={CHECKED:"1",REFUNDED:"3",TO_RIDE:"2"},userInfo=JSON.parse(localStorage.getItem("userInfo"));function init(){userInfo=JSON.parse(localStorage.getItem("userInfo")),queryDetailByOrderNo(function(e){var t=createElementObj(e);0<t.length&&showElement(t)})}function getElementToPageTop(e){return e.parentElement?this.getElementToPageTop(e.parentElement)+e.offsetTop:e.offsetTop}function setFooterPosition(){document.documentElement.clientHeight-10<=getElementToPageTop(document.getElementById("heightPoint"))?$("footer").css({position:"relative","margin-top":".75rem"}):$("footer").css({position:"fixed","margin-top":".75rem"})}function showElement(e){var i=$(".order-content");e.forEach(function(e){var t='<div class="order-item">'+('<div class="order-top">  <div class="head">    <div class="time">'+formatDateToString(new Date(e.ticketTime),!0)+'</div>    <div class="line-name">'+e.scheduleCode+'</div>    <div class="license-plate">'+e.carNo+'</div>  </div>  <div class="station">    <div class="station-item departure">'+e.departCity+e.departStation+'</div>    <div class="station-item arrival">'+e.arriveCity+e.arriveStation+"</div></div></div>")+'<div class="checkanimat"></div><div class="order-bottom"></div></div>';$(i).append(t),showTicketList(e.ticketInfoList),"1"==getUrlParams().ifQuickCheck?$(".checkanimat").flightChart({flights:["/src/images/commutingBus/check-animat/01.png","/src/images/commutingBus/check-animat/02.png","/src/images/commutingBus/check-animat/03.png","/src/images/commutingBus/check-animat/04.png","/src/images/commutingBus/check-animat/05.png","/src/images/commutingBus/check-animat/06.png","/src/images/commutingBus/check-animat/07.png","/src/images/commutingBus/check-animat/08.png"],flightSpeed:3,text:e.code}):$(".checkanimat").hide(),setTimeout(function(){setFooterPosition()},0)})}function createElementObj(e){var i=[],a=[],s=[];return e.forEach(function(e){var t={};s.includes(e.orderNo)?(a.push({verifyCode:e.verifyCode,idCardNo:e.idCardNo,passengerName:e.passengerName,ticketSerialNo:e.ticketSerialNo,status:e.status}),t.ticketInfoList=a):(s.push(e.orderNo),t=e,a.push({verifyCode:e.verifyCode,idCardNo:e.idCardNo,passengerName:e.passengerName,ticketSerialNo:e.ticketSerialNo,status:e.status}),t.ticketInfoList=a,i.push(t))}),i}function queryDetailByOrderNo(i){var e=getUrlParams(),t={orderNo:e.orderNo,departDate:e.departDate,clientType:serverUtil.clientType,appId:serverUtil.appId,token:serverUtil.token,appVersion:serverUtil.appVersion,timestamp:(new Date).getTime(),deviceId:serverUtil.deviceId,wechatLogin:serverUtil.wechatLogin};request(commuteApi.queryDetailByOrderNo,t).then(function(e){if(0==e.code&&i&&"function"==typeof i)if(null!=e.data&&null!=e.data){i(e.data);var t=new Date(e.data[0].ticketTime);countDown(new Date(e.timestamp),t)}else i([])})}function countDown(e,t){var i=format((t.getTime()-e.getTime())/1e3);console.log(i);var a=setInterval(function(){0<i.second?i.second--:0<i.minute?(i.minute--,i.second=59):0<i.hour?(i.hour--,i.minute=59,i.second=59):(i.second=0,clearInterval(a)),fullCount(i)},1e3)}function fullCount(e){var t=$(".header-tips");if(null==e.hour&&(e.hour=0),null==e.minute&&(e.minute=0),e.hour<=0&&e.minute<=0&&e.second<=0)$(t).hide();else{var i="还剩"+e.hour+"小时"+e.minute+"分"+e.second+"秒上车";$(t).text(i),$(t).show()}}function getUrlParams(){var e=window.location.href;return{orderNo:getParam("orderNo",e),departDate:getParam("departDate",e),ifQuickCheck:"1"}}function showTicketList(e){var t=$(".order-bottom"),a="",s="";if(e.forEach(function(e,t){var i="";null!=e.idCardNo&&""!=e.idCardNo&&(i="<div>姓名："+e.passengerName+"</div><div>身份证："+e.idCardNo+"</div>"),a+='<li data-status="'+e.status+'">  <div class="check-in-tips">验票码</div>  <div class="check-in-code">'+e.verifyCode+'</div>  <div class="ticket-info">    <div>票号：'+e.ticketSerialNo+"</div>"+i+'  </div>  <div class="status '+getStatusClassName(e.status)+'"></div></li>',s+=0==t?'<span class="active"></span>':"<span></span>"}),e.length<=1)var i='<div class="slider-box" style="height:3.04rem;"><div class="ticket-list slider">  <ul class="slider-main clearfloat">'+a+"  </ul></div></div>";else i='<div class="slider-box" style="height:3.44rem;"><div class="ticket-list slider">  <ul class="slider-main clearfloat">'+a+'  </ul></div><div class="list-index">'+s+"</div></div>";$(t).append(i);var n=$(".order-bottom").width();$(".slider-main li").width(n+"px"),$(".slider").width(n+"px").css({overflow:"hidden"}),$(".slider-main").width(n*e.length+"px"),sliderCheckNo(e.length,n)}function sliderCheckNo(i,a){var s,n,o,r,c,d,l=1,u=$(".slider-main");$(".slider-main li").on("touchstart",function(e){s=e.touches[0].pageX,n=e.touches[0].pageY}),$(".slider-main li").on("touchend",function(e){o=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY,c=o-s,d=r-n,Math.abs(c)>Math.abs(d)&&0<c?1<l&&(l--,u.css({left:-a*(l-1)+"px"})):Math.abs(c)>Math.abs(d)&&c<0&&l<i&&(l++,u.css({left:-a*(l-1)+"px"}));var t=$(".list-index").children("span")[l-1];$(t).addClass("active").siblings().removeClass()})}function getStatusClassName(e){var t="";return e==TICKET_STATUS.CHECKED?t="checked":e==TICKET_STATUS.REFUNDED?t="refunded":e==TICKET_STATUS.TO_RIDE&&(t="toride"),t}$(function(){init()});