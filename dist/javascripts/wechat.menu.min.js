!function(e){String.prototype.getLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length},String.prototype.getShortForm=function(e,n){var t=this;if(this.getLength()>e){n||(n="");for(var a=0,i=0;i<e;i++)if(t.charCodeAt(i)>255?a+=2:a+=1,a>=e){t=t.slice(0,i+1)+n;break}return t}return this+""};var n=[],t="字数不超过4个汉字或8个字母",a="字数不超过8个汉字或16个字母",i=function(n,i){e("#menuNone").hide(),e("#menuRightBox").show(),e("#menuName").val(n.name),e("#menuType"+n.type).iCheck("check"),1==n.type?(e("#menuUrl").val(""),e("#menuContent").val(n.content),e("#menuTab1").show(),e("#menuTab2").hide()):2==n.type&&(e("#menuContent").val(""),e("#menuUrl").val(n.content),e("#menuTab1").hide(),e("#menuTab2").show()),i?(e(".menu-form .frm-tips").text(t),n.sub.length>0?e(".menu-sub-form").hide():e(".menu-sub-form").show()):(e(".menu-form .frm-tips").text(a),e(".menu-sub-form").show())},r=function(){var i=e(".mobile-bd .current");if(!(i.length<=0)){var r=i.index(),s=n,l=e.trim(e("#menuName").val()),o=e('input[type="radio"][name="menuType"]:checked').val(),u=1==o?e.trim(e("#menuContent").val()):e.trim(e("#menuUrl").val());if(l.length<=0&&e("#menuName").next(".frm-tips").addClass("text-error").text("菜单名称不能为空。"),i.hasClass("parent-menu-item"))l.length<=0?l="菜单名称":e("#menuName").next(".frm-tips").text(t).removeClass("text-error"),l=l.getShortForm(8),s[r].name=l,s[r].sub.length<=0&&(s[r].type=o,s[r].content=u);else{l.length<=0?l="子菜单名称":e("#menuName").next(".frm-tips").text(a).removeClass("text-error"),l=l.getShortForm(16);var m=i.parent().closest("li").index();s[m].sub[r].name=l,s[m].sub[r].type=o,s[m].sub[r].content=u}i.children("a").text(l)}},s=function(){e(".parent-menu-data .parent-menu-link").off("click").on("click",function(){r(),e("#menuName").next(".frm-tips").removeClass("text-error"),e(".mobile-bd .current").removeClass("current"),e(this).parent().addClass("current"),e(".sub-menu-box:visible").hide(),e(this).parent().children(".sub-menu-box").show();var t=e(this).parent().index();i(n[t],!0)}),e(".child-menu-data").off("click").on("click",function(){r(),e("#menuName").next(".frm-tips").removeClass("text-error"),e(".mobile-bd .current").removeClass("current"),e(this).addClass("current");var t=e(this).index(),a=e(this).parent().closest("li").index();i(n[a].sub[t],!1)})},l=function(){e(".add-child-menu").off("click").on("click",function(){r();var t={name:"子菜单名称",type:1,content:""},a=e(this).parent().closest("li").index();n[a].sub.push(t),n[a].type=1,n[a].content="",e(".mobile-bd .current").removeClass("current");var l='<li class="child-menu-data current"><a href="javascript:void(0)">'+t.name+"</a></li>";e(this).before(l),n[a].sub.length>=5&&e(this).hide(),s(),i(t,!1)})};window.wechatMenu={defaults:[],update:r,get:function(){r();var t=[];return e.each(n,function(n,a){var i={name:a.name,type:a.type,content:a.content},r=[];e.each(a.sub,function(e,n){e<5&&r.push({name:n.name,type:n.type,content:n.content})}),i.sub=r,n<3&&t.push(i)}),t},reset:function(){e(".mobile-bd").html(""),e("#menuNone").show(),e("#menuRightBox").hide(),this.initialize(null)},initialize:function(t){t?n=t:this.defaults&&(n=[],e.each(this.defaults,function(t,a){var i={name:a.name,type:a.type,content:a.content},r=[];e.each(a.sub,function(e,n){e<5&&r.push({name:n.name,type:n.type,content:n.content})}),i.sub=r,t<3&&n.push(i)})),e("#menuNone").text("请点击左侧菜单进行编辑操作~!");var a="";if(e.each(n,function(t,i){3==i.type?a+='<li class="parent-menu-hide parent-menu-data parent-menu-item zone'+n.length+(t>=2?" no_extra":"")+'"><a class="parent-menu-link" href="javascript:void(0)">'+i.name+'</a><div class="sub-menu-box" style="display:none"><ul>':a+='<li class="parent-menu-data parent-menu-item zone'+n.length+(t>=2?" no_extra":"")+'"><a class="parent-menu-link" href="javascript:void(0)">'+i.name+'</a><div class="sub-menu-box" style="display:none"><ul>',e.each(i.sub,function(e,n){a+='<li class="child-menu-data"><a href="javascript:void(0)">'+n.name+"</a></li>"}),i.sub.length<5&&(a+='<li class="add-child-menu"><a href="javascript:void(0)"><i class="icon"></i></a></li>'),a+='</ul><i class="arrow arrow-out"></i><i class="arrow arrow-in"></i></div></li>'}),0==n.length?a+='<li class="parent-menu-item add-parent-menu current zone'+n.length+'"><a class="parent-menu-link" href="javascript:void(0)"><i class="icon"></i> 添加菜单</a></li>':a+='<li class="parent-menu-item add-parent-menu zone'+n.length+'"'+(n.length>=3?'style="display:none"':"")+'><a class="parent-menu-link" href="javascript:void(0)"><i class="icon"></i></a></li>',e(".mobile-bd").html(a),n.length>0){t=n[0];i(t,!0),e(".parent-menu-data").eq(0).addClass("current").children(".sub-menu-box").show(),s(),l()}e(".add-parent-menu").off("click").on("click",function(){n.length<=0?e(this).html('<a class="parent-menu-link" href="javascript:void(0)"><i class="icon"></i></a>').removeClass("current"):r();var t={name:"菜单名称",type:1,content:"",sub:[]},a=n.length;n.push(t),e(".parent-menu-item").removeClass("zone"+a).addClass("zone"+n.length),e(".mobile-bd .current").removeClass("current"),e(".sub-menu-box").hide(),n.length>=3&&e(this).hide();var o='<li class="parent-menu-data parent-menu-item current zone'+n.length+(n.length>=3?" no_extra":"")+'"><a class="parent-menu-link" href="javascript:void(0)">'+t.name+'</a><div class="sub-menu-box"><ul><li class="add-child-menu"><a href="javascript:void(0)"><i class="icon"></i></a></li></ul><i class="arrow arrow-out"></i><i class="arrow arrow-in"></i></div></li>';e(this).before(o),s(),l(),i(t,!0)}),e('input[type="radio"][name="menuType"]').on("ifChecked",function(n){1==e(this).val()?(e("#menuTab1").show(),e("#menuTab2").hide()):2==e(this).val()&&(e("#menuTab1").hide(),e("#menuTab2").show())}),e("#menuName").keyup(function(){r()}),e(".menu-form .delete-btn").off("click").on("click",function(){e.sui.confirm("是否确定要移除此微信菜单项？",function(){var t=e(".mobile-bd .current");if(!(t.length<=0)){var a=t.index();if(t.hasClass("parent-menu-data"))n.splice(a,1),t.remove(),e(".mobile-bd").children("li").removeClass("zone"+(n.length+1)).addClass("zone"+n.length),n.length>0?(e(".mobile-bd").children("li").eq(n.length-1).removeClass("no_extra"),e(".add-parent-menu").show().children("a").html('<i class="icon"></i>')):e(".add-parent-menu").show().addClass("current").children("a").html('<i class="icon"></i> 添加菜单');else{var i=t.parent().closest("li").index();n[i].sub.splice(a,1),t.remove(),e(".add-child-menu").show()}e("#menuNone").show(),e("#menuRightBox").hide()}})})}}}(jQuery);