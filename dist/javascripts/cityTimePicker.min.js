var zeroize=function(e){return e>9?e:"0"+e},getDate=function(e){return{text:zeroize(e.getMonth()+1)+"月"+zeroize(e.getDate())+"日",value:e.getFullYear()+"-"+zeroize(e.getMonth()+1)+"-"+zeroize(e.getDate())}},getTime=function(e,t){return{text:zeroize(e)+":"+zeroize(t),value:zeroize(e)+":"+zeroize(t)}},getNow=function(){var e=new Date((new Date).getTime());return e.setHours(e.getHours()+1),e.getMinutes()<30?e.setMinutes(30):e.setMinutes(60),e},filterHoursHours=function(e,t){for(var a,u=[],r=[],i="2017-09-22T",n=0;n<e.length;n++)a=e[n].split("~"),r.push([new Date(i+a[0]),new Date(i+a[1])]);for(var l=[],o=0;o<t.length;o++)a=t[o].value.split("~"),l.push([new Date(i+a[0]),new Date(i+a[1])]);for(var s=0;s<r.length;s++)for(var v=0;v<l.length;v++)l[v][0]>=r[s][0]&&l[v][0]<r[s][1]&&u.push(t[v]);return u};function getAddDays(e){var t=new Date((new Date).getTime()),a=t.getHours(),u=Number(t.getMinutes())+Number(e.data("intervalminute")),r=Math.floor(u/60);return Math.floor((a+r)/24)}function getAddHours(e){var t=new Date((new Date).getTime()),a=t.getHours(),u=Number(t.getMinutes())+Number(e.data("intervalminute"));return{hour:a=(a+Math.floor(u/60))%24,minute:u%60}}var initCityTimePicker=function(e,t){var a={},u=e;a.key=u.prop("id");var r=new Date,i=[],n=getAddDays(u),l=getDate(r).value;0==n?(i.push({value:getDate(r).value,text:"今天"}),r.setDate(r.getDate()+1)):(r.setDate(r.getDate()+n),l=getDate(r).value);for(var o=0;o<5;o++)i.push({value:getDate(r).value,text:getDate(r).text}),r.setDate(r.getDate()+1);a.day=i;var s,v,h,g=[];for(o=0;o<24;o++)s=getTime(o,0),v=getTime(o,30),h=getTime(o+1,0),g.push({value:s.value+"~"+v.value,text:s.text+"~"+v.text}),g.push({value:v.value+"~"+h.value,text:v.text+"~"+h.text});if(""!=$.trim(u.data("filter"))&&(g=filterHoursHours(u.data("filter").split(","),g)),3===$(this).data("level"))for(o=0;o<24;o++)o<10&&(o="0"+o),g.push({value:o,text:o+"点"});if(a.hour=g,a.minute=[{value:"",text:""}],3===$(this).data("level")){var d=[{value:"",text:""}];for(o=0;o<60;o++)o<10&&(o="0"+o),d.push({value:o,text:o+"分"});a.minute=d}r=getNow();a.data={day:getDate(r).value,hour:getTime(r.getHours(),r.getMinutes()).value,minute:""},u.val()&&(a.data={day:u.data("date"),hour:u.data("time"),minute:""}),a.onChange=function(e,t,r,i){if("day"===t){getNow();if(r.day.find(".selected").data("value")==l)r.hour.find("li").each(function(){if($(this).data("value")){var e=$(this).data("value").split("~")[0].split(":"),t=getAddHours(u);(e[0]<t.hour||e[0]==t.hour&&e[1]<t.minute)&&$(this).remove()}});else{var n="<li></li><li></li>",o=' class="selected"';$.each(a.hour,function(e,t){e>0&&(o=""),n+='<li data-value="'+t.value+'"'+o+">"+t.text+"</li>"}),n+="<li></li><li></li>",r.hour.find("ul").html(n)}i.hour&&(i.hour.refresh(),r.hour.find("ul").animate({translate:"0px,0px"},"fast","linear"))}},$.timePicker(a,function(e,a){if(a.hour&&(u.val(a.day+" "+a.hour.split("~")[0]),u.data("date",e.day),u.data("time",e.hour),null!=t&&"function"==typeof t)){var r={date:e.day,time:e.hour};t(r)}})};