var clickEvent=isAndroid()?"tap":"click";function getParam(t){var e=location.search,i=new Object;if(-1!=e.indexOf("?")){var a=e.substr(1);strs=a.split("&");for(var r=0;r<strs.length;r++)i[strs[r].split("=")[0]]=unescape(strs[r].split("=")[1])}return i[t]}function statisticaCount(t){var e={f:getParam(f),trace:t};$.ajax({type:"POST",url:"/wechat/marketing/userTrace",data:e,dataType:"json",success:function(t){},error:function(t){}})}function statisticaCount(t){var e={f:getParam("f"),trace:t};$.ajax({type:"POST",url:"/wechat/marketing/userTrace",data:e,dataType:"json",success:function(t){},error:function(t){}})}function thumbUpEvent(){$(".thumb_up").on(clickEvent,function(){thumbUp($(this)),initShareConfig()})}function thumbUp(t){var e={},i=t.prev(),a=parseInt(i.text());e.providerId=getParam("providerId");var r=t.parent().find(".provider").text();e.providerId1=t.parent().find(".provider-id").text(),$.ajax({type:"POST",url:"/wechat/marketing/like",data:e,dataType:"json",success:function(e){if(null!=e&&0==e.code){var n=e.data;null!=n&&(i.text(a+n.hot),$(".popup").show(),$(".popup-provider").text(r),$(".popup-overlay").show().css("opacity",".5"),t.html('<img src="../../front/dist/images/operation/unclickable.png">')),statisticaCount("点赞")}else $.confirm(e.msg)}})}function queryProvider(){var t={providerId:getParam("providerId")};$.ajax({type:"POST",url:"/wechat/marketing/info",data:t,dataType:"json",success:function(t){if(null!=t&&0==t.code){var e=t.data;null!=e&&null!=e&&drawingPage(e)}}})}function drawingPage(t){for(var e="",i=t.line,a=0;a<i.length;a++){var r=a+1,n=i[a];0==a&&(r='<img src="../../front/dist/images/operation/NO_1.png">'),1==a&&(r='<img src="../../front/dist/images/operation/NO_2.png">'),2==a&&(r='<img src="../../front/dist/images/operation/NO_3.png">');var s=parseFloat(n.exp);e+='<ul><li class="ranking">'+r+'</li><li class="provider"><img src="'+n.logo+'">'+n.provider_name+'</li><li class="provider-id" style="display: none">'+n.provider_id+'</li><li class="index">'+Math.round(s)+'</li><li class="hot">'+n.hot+"</li>",1==n.status?e+='<li class="thumb_up"><img src="../../front/dist/images/operation/unclickable.png"></li>':e+='<li class="thumb_up"><img src="../../front/dist/images/operation/clickable.png"></li>',e+="</ul>"}$(".show-less").append(e),$(".operation-introduction-tips span em").text(t.time),$(".show-less ul").each(function(t){t>5&&$(this).hide(),$(".show-more").on(clickEvent,function(){$(".show-less ul").show(),$(".show-more").hide()})}),thumbUpEvent()}$(".popup-close").on(clickEvent,function(){$(".popup-overlay").hide(),$(".popup").hide()}),$("#tel").on(clickEvent,function(){$.confirm("拨打电话:<br/>"+$("#tel").data("tel"),"",function(){window.location.href="tel://"+$("#tel").data("tel")})}),$(".show-less ul").each(function(t){t>4&&$(this).hide(),$(".show-more").on(clickEvent,function(){$(".show-less ul").show(),$(".show-more").hide()})});var shareObj={reqURL:window.location.href,title:"道路客运年度盛典，运营先锋大赛火热进行中",desc:"年度人气客运企业等你投票！",imgUrl:"",appId:"wx55a6247bbbcc41bc"};function initShareConfig(t){var e={providerId:getParam("providerId")};$.ajax({type:"POST",url:"/wechat/marketing/share",data:e,dataType:"json",success:function(t){if(0==t.code){var e=t.data;shareObj.title=e.title,shareObj.reqURL=e.link,shareObj.desc=e.desc,shareObj.imgUrl=e.icon,wxJsSdk.share(shareObj.title,shareObj.reqURL,shareObj.desc,shareObj.imgUrl,getParam("f"))}else alert("请求失败")}})}$(function(){queryProvider(),initShareConfig(),statisticaCount("访问")});